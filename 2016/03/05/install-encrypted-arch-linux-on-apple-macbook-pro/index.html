<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Installing (encrypted) Arch Linux on an Apple MacBook Pro</title><meta property="og:site_name" content="0xADADA"/><meta property="og:title" content="Installing (encrypted) Arch Linux on an Apple MacBook Pro"/><meta name="twitter:title" content="Installing (encrypted) Arch Linux on an Apple MacBook Pro"/><link rel="canonical" href="https://0xadada.pub/2016/03/05/install-encrypted-arch-linux-on-apple-macbook-pro/"/><meta property="og:url" content="https://0xadada.pub/2016/03/05/install-encrypted-arch-linux-on-apple-macbook-pro/"/><meta name="twitter:url" content="https://0xadada.pub/2016/03/05/install-encrypted-arch-linux-on-apple-macbook-pro/"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@0xadada"/><meta name="author" content="0xADADA"/><meta property="og:type" content="article"/><meta name="description" content="A howto guide for installing encrypted Arch Linux on an Apple MacBook Pro with battery optimization and the Awesome window manager."/><meta name="og:description" content="A howto guide for installing encrypted Arch Linux on an Apple MacBook Pro with battery optimization and the Awesome window manager."/><meta name="twitter:description" content="A howto guide for installing encrypted Arch Linux on an Apple MacBook Pro with battery optimization and the Awesome window manager."/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="https://0xadada.pub/favicon.ico"/><link rel="home" href="https://0xadada.pub/"/><link rel="manifest" href="https://0xadada.pub/static/images/meta/0xadada.webmanifest"/><link rel="apple-touch-icon" href="https://0xadada.pub/static/images/meta/apple-touch-icon.png"/><link rel="icon" type="image/png" href="https://0xadada.pub/static/images/meta/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="https://0xadada.pub/static/images/meta/favicon-16x16.png" sizes="16x16"/><link rel="mask-icon" href="https://0xadada.pub/static/images/meta/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-config" content="https://0xadada.pub/static/images/meta/browserconfig.xml"/><meta name="theme-color" content="#FDF9F0"/><meta name="pocket-site-verification" content="7431f135e23a84de547e5b79dab406"/><meta name="next-head-count" content="26"/><link rel="preload" href="/_next/static/css/d0809774977ec038.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d0809774977ec038.css" data-n-g=""/><link rel="preload" href="/_next/static/css/e491c5ad83d0116a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e491c5ad83d0116a.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-514908bffb652963.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-22b044904a3f81e0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-929aade252cc0f2b.js" defer=""></script><script src="/_next/static/chunks/392-e44e3e95fe0288b1.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bday%5D/%5Bslug%5D-1dbbc016bd444fa6.js" defer=""></script><script src="/_next/static/x1pzJ5b6uIlSp_6eMoFIg/_buildManifest.js" defer=""></script><script src="/_next/static/x1pzJ5b6uIlSp_6eMoFIg/_ssgManifest.js" defer=""></script><script src="/_next/static/x1pzJ5b6uIlSp_6eMoFIg/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><main class="layout_layout__Xf50c"><article class="hentry h-entry" lang="en-US"><header><h1 class="entry-title p-name">Installing (encrypted) Arch Linux on an Apple MacBook Pro</h1><time class="byline_published__8ePA_ dt-published" dateTime="2016-03-05T11:35:00.000Z">Saturday March 5, 2016</time><br/><span class="byline_byline__jNP6Q h-card">by: <span class="author fn p-author p-name">0xADADA</span></span></header><div class="entry-content e-content"><p>In the style of <a href="https://mchladek.me/post/arch-mbp/">Michael Chladek</a>, I thought
it would be useful to my future-self and others, if I wrote up a summary of
installing Arch Linux on Apple MacBook hardware. Of course there are other
guides out there, but this one is specific to the needs of someone looking for a
minimalist, reproducible, secure, performance oriented installation of Arch
Linux.</p>
<p>In following this guide, I've made some decisions that are entirely based on my
own (subjective) opinions. These opinions are based on my experiences with other
operating systems and distros, and a number of window managers I've tried.</p>
<p>My decisions (take them or leave them):</p>
<ul>
<li>Distribution: Arch Linux</li>
<li>Full disk encryption: On</li>
<li>Window Manager: Awesome</li>
<li>Typography: infinality-bundle with the "Free" preset</li>
</ul>
<p>This article assumes you're currently running on a MacBook Pro between
generation 7,1 (Mid-2010), 8,2 (Early-2011) or 11,3 (Late-2013). It assumes
you're running OS X and already have some experience with Linux commands, disk
partitions and GNU/Linux. I've tested this guide on both of the above
generations, but I'm assuming it'll work on anything in between. However, I make
no guarantees.</p>
<p>If you just want to get on to the installation, skip to this link:
<a href="#installing-arch">Installing Arch</a>.</p>
<p><strong>Contents</strong>:</p>
<ul>
<li><a href="#background">Background</a>
<ul>
<li><a href="#why-apple">Why Apple?</a></li>
<li><a href="#why-arch">Why Arch?</a></li>
<li><a href="#why-awesome">Why Awesome?</a></li>
</ul>
</li>
<li><a href="#preparing-to-install-arch">Preparing to Install Arch</a>
<ul>
<li><a href="#getting-the-installation-media">Getting the Installation Media</a></li>
<li><a href="#preparing-the-installation-usb-drive">Preparing the Installation USB Drive</a></li>
</ul>
</li>
<li><a href="#installing-arch">Installing Arch</a>
<ul>
<li><a href="#test-internet">Test Internet</a> and
<a href="#set-the-system-clock">Set the System Clock</a></li>
<li><a href="#partition-the-hard-drive">Partition the Hard Drive</a></li>
<li><a href="#configuring-drive-encryption-and-lvm">Configuring Drive Encryption and LVM</a></li>
<li><a href="#select-a-mirror">Select a Mirror</a></li>
<li><a href="#install-the-base-system">Install the Base System</a></li>
<li><a href="#generate-the-fstab">Generate the fstab</a></li>
<li><a href="#configure-the-system">Configure The System</a></li>
<li><a href="#boot-loader">Boot Loader</a></li>
<li><a href="#reboot-into-new-installation">Reboot into New Installation</a></li>
</ul>
</li>
<li><a href="#configuring-arch">Configuring Arch</a>
<ul>
<li><a href="#install-an-arch-user-repository-package-manager">Install an Arch User Repository Package Manager</a></li>
<li><a href="#configure-sound">Configure Sound</a></li>
<li><a href="#install-x-and-video-drivers">Install X and Video Drivers</a></li>
<li><a href="#some-gui-applications">Some GUI Applications</a></li>
<li><a href="#improved-typography">Improved Typography</a></li>
<li><a href="#window-manager-awesome">Window Manager Awesome</a></li>
<li><a href="#touchpad-support">Touchpad Support</a></li>
<li><a href="#configuring-wireless">Configuring Wireless</a></li>
<li><a href="#done">Done!</a></li>
</ul>
</li>
<li><a href="#fine-tuning">Fine Tuning</a>
<ul>
<li><a href="#display-color-profile">Display Color Profile</a></li>
<li><a href="#display-color-correction">Display Color Correction</a></li>
<li><a href="#power-management">Power Management</a></li>
<li><a href="#laptop-mode-tools">Laptop Mode Tools</a></li>
<li><a href="#acpid">acpid</a></li>
<li><a href="#cpu-frequency-scaling">CPU Frequency Scaling</a></li>
<li><a href="#temperature-management">Temperature Management</a></li>
<li><a href="#fan-control">Fan Control</a></li>
<li><a href="#apple-keyboard">Apple Keyboard</a></li>
<li><a href="#apple-trackpad">Apple Trackpad</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#references">References</a></li>
<li><a href="#footnotes">Footnotes</a></li>
</ul>
<p>This article will be installing Arch Linux alongside OS X, dual-booting such
that you can easily boot into either. I recommend this, even if you’re not going
to be using OS X at all, because right now (and likely for the foreseeable
future) the only way to get firmware updates installed on your machine will be
via OS X. There have been Linux kernel–MacBook Pro firmware compatibility issues
in the past that have been fixed by OS X updates that installed firmware fixes.</p>
<p>I assume you have already repartitioned your drive giving you plenty of free
space for Arch. On my 500GB drive, I left 80GB for OS X (probably much more than
really necessary) and the rest I left free for Arch.</p>
<p><strong>Conventions</strong></p>
<p>For commands typed as the normal user, I will not prefix them:</p>
<pre><code class="language-bash">uname -a
</code></pre>
<p>For commands that need to be executed as a root account, i will prefix them with
a hash-mark: <code>#</code></p>
<pre><code class="language-bash"># uname -a
</code></pre>
<h2>Background</h2>
<h3>Why Apple</h3>
<p>I've been using OS X as my primary OS since 2011 when I bought my first Apple
product, the 15" MacBook Pro 8,2− which I still use today (March 2016, on which
I'm writing this article). This alone is a testament to its' longevity as a
computing platform. The industrial design of the hardware is a pleasure to the
eyes and is much imitated. The hardware feels wonderful to the touch. I've
disassembled a few of them, and despite the security screws, they're fairly easy
to repair or upgrade. Only recently had I felt that its' age was starting to
show, so last week I doubled the ram from 8GB to 16GB and upgraded the hard
drive to a 512GB SSD. This should provide at least another two years of life for
this hardware.</p>
<p>Recently however, Apple has changed their hardware design philosophy from a
fairly open platform to a more proprietary and disposable one. They've
eliminated the ability to change or upgrade components. The
<a href="https://en.wikipedia.org/wiki/MacBook_Pro#3rd_generation_.28Retina.29">3rd generation MacBooks</a>
have a battery that is glued in place, the memory is soldered directly to the
logic board. Later models would come with the hard drive soldered down as well.</p>
<p><a href="http://ifixit.org/blog/2763/the-new-macbook-pro-unfixable-unhackable-untenable/">Lyle Wiens of iFixIt, said it best in 2012</a></p>
<blockquote>
<p>When Apple dropped the MacBook Air to $999 in 2010 to match the price point
of the MacBook, they gave users a clear choice: the thin, light, and
un-upgradeable MacBook Air or the heavier, longer lasting, [upgradable], more
rugged, and more powerful MacBook. Same price, two very different products. At
the time, I wasn’t very happy with the non-upgradeable RAM on the MacBook Air,
but I respected that Apple had given their users a choice. It was up to us:
Did we want a machine that would be stuck with 2GB of RAM forever? Would we
support laptops that required replacement every year or two as applications
required more memory and batteries atrophied?</p>
<p>Consumers overwhelmingly voted yes, and the Air grew to take 40 percent of
Apple’s notebook sales by the end of 2010.</p>
</blockquote>
<p>This sort of vendor-lock down and
<a href="https://en.wikipedia.org/wiki/Planned_obsolescence">planned-obsolecence</a> has
bothered me to such an extent that the next laptop I buy won't be Apple
hardware.</p>
<p>Meanwhile, Apple has secured an
<a href="https://en.wikipedia.org/wiki/Oligopoly">oligopoly</a> in the market, they have
such a dominant position with hardware manufacturers that they seem to be
squeezing competitors out of getting access to top-quality components (or their
competitors don't care about quality). These manufacturers seem to be building
computers with "Apples' scraps and leftovers".</p>
<p>Put simply; I don't see any manufacturers building laptops at the same level of
quality that Apple does, and yet, I can't buy a
product<sup><a href="#user-content-fn-1" id="user-content-fnref-1" data-footnote-ref aria-describedby="footnote-label">1</a></sup> that is so tightly
controlled. Finally, I refuse to buy a product that is designed to be obsolete
in two years.</p>
<h3>Why Arch?</h3>
<p>I first started using Linux in 1997 when I bought a
<a href="https://upload.wikimedia.org/wikipedia/en/thumb/4/49/Redhat_5.2_box.jpg/220px-Redhat_5.2_box.jpg">shrink-wrapped box of RedHat Linux 5.2</a>.
At the time, my internet connection was fast but not reliable enough to download
the ISO image over a 1-day dial-up session. Since then I've tried Slackware,
SuSE, Mandrake, Debian, Fedora, Ubuntu, CentOS, and Mint. I customized the hell
out of my distros, I performance tweaked, secured and customized the GUI. Back
then, information was hard to come by, the community was still small and poorly
documented, and that hardly mattered when I couldn't access the internet because
my ethernet card drivers wouldn't compile.</p>
<p><a href="https://medium.com/@fun_cuddles/linux-of-the-90s-or-why-i-have-linux-desktop-ptsd-1f276a7887fb#.jwg8up61m">Jen Andre sums it up best</a></p>
<blockquote>
<p>You kids these days. You have it easy.</p>
</blockquote>
<p>It was enjoyable for a while, but I got very busy and eventually came to the
conclusion that "Linux is free if your time is worth nothing" and stuck with OS
X. I would occasionally install and try a different distro just to see if the
OSS operating system world had changed, but that was about it.</p>
<p>Arch is different however. Arch gets it, Arch gets it right. Arch is what I was
searching for all those years.</p>
<ol>
<li>A rolling release cycle keeps everything fresh</li>
<li>I'm a huge advocate for their KISS Principal: Keep it Simple…</li>
<li>The documentation is widely regarded as the best source of info on GNU/linux</li>
<li>The Core package repository is very well maintained and trusted</li>
<li>The User package repository is great at providing pretty much everything you
could need or want</li>
<li>Its designed for people who want to understand and build a system from the
ground up. Install only what you know, only what you understand. It doesn't
hide anything behind assumptions, scripts or fancy installers.</li>
</ol>
<blockquote>
<p>Arch is like a sandbox, they provide the box and a source of sand (the Core
and User package repos), but it's up to you to fill it and build your castle.</p>
</blockquote>
<h3>Why Awesome?</h3>
<p>Like the topic of GNU/Linux distros, I could spend an entire post talking about
why I settled on Awesome. I've tried GNOME, KDE, even Enlightenment. They all
are trying to do more than I need, are too influenced by the design of the Big
Desktop players and pander to novices at the expense of the power users.</p>
<p>All I really need is a quick way to switch between windows and resize them as
needed and for it to be fast. The focus of the window manager is the application
contents, not the chrome eye-candy around the edges of the window.</p>
<p>Awesome was designed for this.</p>
<p>So, this guide is going to install Awesome as it's window manager. Feel free to
switch it out for whatever you prefer. i3, xmonad and DWM are all similar in
design.</p>
<h2>Preparing to Install Arch</h2>
<p>When doing this article, I found many other articles very useful. They are
listed in <a href="#references">References</a>. Please refer to them if needed. I will
attempt to both update and condense these articles to a single "Be-all End-all
Guide" to MacBook installation.</p>
<h3>Getting the Installation Media</h3>
<p>First, we need to get Arch Linux ISO from Arch Linux,
<a href="https://www.archlinux.org/download/">Go here to download it</a></p>
<p>I usually go with the torrent option. It's the fastest.</p>
<p>Next, we’re just going to make sure the download wasn’t corrupted or tampered
with in transit. To make this possible, the Arch Linux ISO publisher has posted
a cryptographic hash of the ISO. We can compare the hash of the ISO they
published against the hash of the ISO we downloaded. If the hash is identical,
we know the contents are exactly the same. Start the terminal and run the
following:</p>
<pre><code class="language-bash">sha1sum &#x3C;FILE>.iso
</code></pre>
<p>Next, we want to make sure the the ISO we've downloaded is provably supplied by
the Arch Linux team. We can do this by verifying the cryptographic signature
they provided with the ISO. The Arch team cryptographically signs their ISO
images using public-key cryptography. This ensures that the ISO file we've
downloaded is verifiably provided by the Arch Linux team, and not an impostor.</p>
<p>This assumes you have GnuPG installed on your system (<code>brew install gnupg</code>). On
the ISO download page, there is a link under “Checksums” to get the PGP
signature as a <code>.sig</code> file. Download that into the same directory as your Arch
ISO. Then run the following, replacing the filename (here i use
<code>archlinux-2016-02-01-dual.iso</code>) with the name of the files you've downloaded:</p>
<pre><code class="language-bash">gpg --verify \
    archlinux-2016.02.01-dual.iso.sig \
    archlinux-2016.02.01-dual.iso 2>&#x26;1 | \
    grep 'key ID' | \
    gpg --recv-keys 2>&#x26;1 `awk '{print $NF}'` &#x26;&#x26; \
gpg --verify archlinux-2016.02.01-dual.iso.sig \
    archlinux-2016.02.01-dual.iso 2>&#x26;1 | grep 'signature from'
</code></pre>
<p>This will first attempt to verify the signature, and if you don't have the
signers key, it'll retrieve it. It'll then try to verify it again, and should
print out "Good signature" if it succeeds. If you get "Bad signature" this means
the ISO has either been forged by an impostor pretending to be the Arch linux
team, or someone has tampered with the ISO stored on their servers or in
transit. If thats the case, you need to find an alternate source to download the
ISO.</p>
<h3>Preparing the Installation USB Drive</h3>
<p>This installation method will first create a bootable USB stick, which is used
to boot into a "Live" Arch Linux session. From there, we use the Live Arch Linux
to install Arch onto your MacBook hard drive, then make that partition bootable.</p>
<p>If you're currently running a GNU/Linux system, follow the instructions in
<a href="#part-a---preparing-the-installation-usb-drive-for-linux">Part A</a>. If you're
running OS X,
<a href="#part-b---preparing-the-installation-usb-drive-for-osx">jump one section ahead to Part B</a>.</p>
<h4>Part A - Preparing the Installation USB Drive for Linux</h4>
<p>If you're already on a GNU/Linux system, use these instructions to create USB
bootable Arch Linux live system.</p>
<p>Now we’re ready to get that ISO onto a USB drive so we can boot the computer
from it. Before inserting the thumb drive, run <code>lsblk</code> and take note of the
drives listed. Insert the drive and run <code>lsblk</code> again. Take note of the new
letter in the <code>sdX</code> list of drives.</p>
<p>Replace the <code>X</code> with the letter on your system. Be sure to unmount the new
drive.</p>
<pre><code class="language-bash">umount /dev/sdX
</code></pre>
<p>Next, run the following command, it reads the ISO file you downloaded earlier
and writes the contents directly to the USB drive, without the operating system
buffering the writes. Replace the <code>X</code> with the letter of the USB stick you took
note of earlier, and <code>ARCHLINUX</code> with the name of the image file you downloaded.</p>
<pre><code class="language-bash">dd if=ARCHLINUX.iso of=/dev/sdX bs=4M
</code></pre>
<p>After that’s run, the USB drive should be ready to boot from.</p>
<h4>Part B - Preparing the Installation USB Drive for OSX</h4>
<p>Now we’re ready to get that ISO onto a USB drive so we can boot the computer
from it. Before inserting the thumb drive, run <code>diskutil list</code> and take note of
the drives listed. You should see output similar to this:</p>
<pre><code>/dev/disk0
   #:                       TYPE NAME          SIZE       IDENTIFIER
   0:      GUID_partition_scheme               500.1 GB   disk0
   1:                        EFI               209.7 MB   disk0s1
   2:          Apple_CoreStorage               399.5 GB   disk0s2
   3:                 Apple_Boot Recovery HD   650.0 MB   disk0s3
   5:                 Apple_Boot Boot OS X     134.2 MB   disk0s5
/dev/disk1
   #:                       TYPE NAME          SIZE       IDENTIFIER
   0:                  Apple_HFS MacOSX        399.2 GB   disk1
</code></pre>
<p>Insert the drive and run <code>diskutil list</code> again. Take note of the new letter in
the <code>sdX</code> list of drives.</p>
<pre><code>/dev/disk0
   #:                       TYPE NAME          SIZE       IDENTIFIER
   0:      GUID_partition_scheme               500.1 GB   disk0
   1:                        EFI               209.7 MB   disk0s1
   2:          Apple_CoreStorage               399.5 GB   disk0s2
   3:                 Apple_Boot Recovery HD   650.0 MB   disk0s3
   5:                 Apple_Boot Boot OS X     134.2 MB   disk0s5
/dev/disk1
   #:                       TYPE NAME          SIZE       IDENTIFIER
   0:                  Apple_HFS MacOSX        399.2 GB   disk1
/dev/diskX
   #:                       TYPE NAME          SIZE       IDENTIFIER
   0:      GUID_partition_scheme               2.0 GB     disk2
   1:       Microsoft Basic Data UNTITLED 1    2.0 GB     disk2s1
</code></pre>
<p>Note <code>/dev/diskX</code> has appeared ('X' will be a number on your system), this new
disk is the USB thumb drive. <strong>Important</strong> <em>take note of the number of this
drive</em>.</p>
<p>We're going to remove the existing partitions and erase all the data so its
clean for our Arch Linux installer. This will delete all the data on the USB
drive. Make sure to substitute <code>/dev/diskX</code> for the drive number you noted
above.</p>
<pre><code class="language-bash">diskutil partitionDisk /dev/diskX 1 "Free Space" "unused" "100%"
</code></pre>
<p>Now<sup><a href="#user-content-fn-4" id="user-content-fnref-4" data-footnote-ref aria-describedby="footnote-label">2</a></sup> we can write the iso
file to the USB drive. <strong>Note</strong> We use <code>/dev/rdisk*</code> instead of <code>/dev/disk</code>
because it provides Raw disk access without the typical buffering the operating
systemprovides. Substitute <code>DESTINATION</code> with the name of the <code>iso</code> file you
downloaded earlier, and substitute the <code>X</code> with the number of the drive.</p>
<pre><code class="language-bash">dd if=DESTINATION.iso of=/dev/rdiskX bs=1m
</code></pre>
<p>The <code>dd</code> command does not show any output before it has finished the copy
process, so be patient and wait for it to complete, it can take around 1 - 5
minutes. When the command does complete OS X will try to mount the drive and
fail as it won't recognize the formatting. Click ignore.</p>
<h2>Installing Arch</h2>
<p>With the USB drive plugged in, restart the MacBook and press+hold down the left
<code>option/alt</code> key when you hear the startup chime. Hold the <code>option</code> key down
until the drive screen appears.</p>
<p>The USB drive should be one of the options. Pick it along with the first option
the following boot screen lists. Now you should be at the Arch live install
prompt and it'll look like this:</p>
<pre><code>Arch Linux 3.17.6-1-ARCH (tty1)

archiso login: root (automatic login)
root@archiso ~ #
</code></pre>
<p>You are now running a "Live" session of Arch Linux from the USB stick.</p>
<p>If you're on a HiDPI / "Retina" display MacBook, the prompt is really small.
Increase the font-size using <code>setfont sun12x22</code>.</p>
<h3>Test Internet</h3>
<p>You'll need a working Internet connection to do the post-install. My MacBook Pro
7,1 and 8,2 both have Ethernet ports, but some of you will have later models
without one. You should get a USB-Ethernet adapter. Its much easier than
fiddling with wireless drivers as it works out of the box. We'll setup the
wireless drivers later in this article.</p>
<p>First, we need to get an IP address from your router:</p>
<pre><code class="language-bash">dhcpcd
</code></pre>
<p>With the adapter plugged in and an IP address, make sure internet is flowing by
pinging Google:</p>
<pre><code class="language-bash">ping -c 3 www.google.com
</code></pre>
<p>You should get a response that all three packets were sent and received.</p>
<h3>Set the System Clock</h3>
<p>The system clock should be just fine. The general Arch wiki recommends ensuring
the system clock is accurate, and I’ve found it doesn’t seem to break anything.
So, I run it:</p>
<pre><code class="language-bash">timedatectl set-ntp true
</code></pre>
<h3>Partition the Hard Drive</h3>
<p>A partition is basically a box on the hard drive to put files into. OS X has a
box for its files, and we're going to create box(es) for GNU/Linux. Partitioning
the hard drive takes existing data on the drive and moves or erases it to make
space available for other file systems.</p>
<p>This part is the trickiest because it can erase data on the disk, so take care.</p>
<p>Apple uses the GUID Partition Table (GPT), and we're going to keep that
partition table.</p>
<p>In order to proceed you'll need to know the drive mapping scheme, we'll use
<code>fdisk</code> to check the scheme:</p>
<pre><code class="language-bash">fdisk -l
</code></pre>
<p>This lists the existing partitions. If you created two partitions when preparing
the MacBook, you should see a partition with a Type of <code>Apple HFS/HFS+</code> with a
size that matches the size you set aside for Arch. In my case this was
<code>/dev/sda5</code>. All the partitioning commands below will use <code>/dev/sda5</code>, <strong>you
should substitute the designation for your drive</strong>.</p>
<p>Lets use <code>cgdisk</code> to view the partition table on the attached devices: Replace
the <code>Y</code> with the drive you'll be using to install Arch Linux.</p>
<pre><code class="language-bash">cgdisk /dev/sdY
</code></pre>
<p>At the end of the partition table should be the free space you set aside for
installing Arch. With that space, we're going to create a new partition. You
just need to make one partition; we’re going to break it into sub-partitions
later; after encryption is setup.</p>
<p>I added 128MB between the last partition and my new partition
<a href="https://developer.apple.com/library/mac/technotes/tn2166/_index.html">because of this explanation by Apple</a>.</p>
<blockquote>
<p>Note: We leave free space after each partition to make it easier for future
system software to manipulate the partition map in ways that we can’t
anticipate currently.</p>
</blockquote>
<p>Begin by deleting the <code>HFS</code> partition created when you set aside space in OS X
for Arch Linux.</p>
<p>In order to leave additional space, just type <code>+128M</code> when you create the new
partition, and it'll set the starting sector at a point 128M away from the
ending sector of the partition before it.</p>
<p>You’ll want to use Linux LVM (<code>8e00</code>) as the partition type id. The final
partition table will look something like this:</p>
<pre><code>Part. #     Size        Partition Type            Partition Name
----------------------------------------------------------------
3.0 KiB      free space
1        200.0 MiB      EFI System                EFI System Partition
2         74.5 GiB      Apple HFS/HFS+            Macintosh HD
128.0 MiB      free space
3        391.1 GiB      Linux LVM                 ArchLinux
</code></pre>
<p>Then use the utility to select Write and then confirm that you want to overwrite
the disk. Once the display returns you can Quit.</p>
<p>Running <code>fdisk -l</code> again should show your new partition scheme. If it doesn't
look like you want or expected, repeat the <code>cgdisk</code> process to fix things until
you're satisfied.</p>
<h3>Configuring Drive Encryption and LVM</h3>
<p>You’ll want to make note of the partition number you just created. For me it’s
partition <code>5</code>, and the drive is <code>sda</code>, so my Arch Linux partition can be found
at <code>/dev/sda5</code>. I'll be using that as an example going forward, <strong>but you should
substitute your own drive path</strong>.</p>
<p>We’re going to encrypt <code>/dev/sda5</code> using DM-Crypt and then the LVM partitions
are going to be created over that LUKS encryption layer. This system is called
"LVM on LUKS." Both LUKS encryption and LVM support are provided by the
GNU/Linux kernel.</p>
<p><strong>Note</strong> This will just encrypt the system <code>/</code> and <code>/home</code> directories. The
<code>/boot</code> directory will not be encrypted because we’re going to keep the existing
<code>/boot</code> partition: That’s <code>/dev/sda1</code> in my partition table above.</p>
<p>If you want to use custom ciphers, there are some great notes
<a href="https://github.com/NoviceLive/unish/blob/master/doc/arch-install.sh#L101">available on GitHub</a>.
You can also use the following command for speed benchmarking to help determine
which ciphers and key-sizes are fast enough for your particular use case:</p>
<pre><code class="language-bash">cryptsetup benchmark
</code></pre>
<p>Time to pick the encryption flavors! The default values for the cipher and key
sizes were a bit too light for my tastes (in light of the NSA spying scandal).
I've increased these numbers above the defaults, I've chosen to balance my
principals for privacy and security with practical usability and speed. Feel
free to
<a href="https://wiki.archlinux.org/index.php/Dm-crypt/Device_encryption#Encryption_options_for_LUKS_mode">read more on these settings</a>.</p>
<pre><code class="language-bash">cryptsetup --cipher aes-xts-plain64 \
  --key-size 512 \
  --hash sha256 \
  --iter-time 3000 \
  --use-random \
  --verify-passphrase \
  luksFormat /dev/sda5
</code></pre>
<p>Enter in a good passphrase (twice), and we should be good to go.</p>
<p>Now with the encryption setup, we’re going to create the necessary volumes and
filesystems within the LVM.</p>
<p>First, let’s open up our encrypted partition:</p>
<pre><code class="language-bash">cryptsetup luksOpen /dev/sda5 lvm
</code></pre>
<p>This is going to map our encrypted device (<code>/dev/sda5</code> in my case) to
<code>/dev/mapper/lvm</code>. Now we’re going to create the physical and logical volumes
for the <code>/</code> and <code>/home</code> directories. I gave the <code>/</code> directory 40GB (hopefully
enough for all my programs. As of writing this, and with a full install, I’m
using 10GB on my <code>/</code> directory. So, I think I’m good.</p>
<p>Create the physical volume:</p>
<pre><code class="language-bash">pvcreate /dev/mapper/lvm
</code></pre>
<p>Now create the volume with the name <code>vgcrypt</code>:</p>
<pre><code class="language-bash">vgcreate vgcrypt /dev/mapper/lvm
</code></pre>
<p>We're ready to create the logical volumes now, <code>40GB</code> for root and the rest for
users’ home, change <code>40GB</code> accordingly:</p>
<pre><code class="language-bash">lvcreate --size 40G --name root vgcrypt
lvcreate --extents +100%FREE --name home vgcrypt
</code></pre>
<p>We now have our two volumes <code>vgcrypt-root</code> and <code>vgcrypt-home</code>. They need to be
formatted to a particular filesystem. I’ve been happy with the <code>ext4</code>
filesystem.</p>
<pre><code class="language-bash">mkfs.ext4 /dev/mapper/vgcrypt-root
mkfs.ext4 /dev/mapper/vgcrypt-home
</code></pre>
<p>We can now mount these new partitions. Make sure to mount the root partition
first so we can create the <code>/home</code> directory inside of it for the home
partition:</p>
<pre><code class="language-bash">mount /dev/mapper/vgcrypt-root /mnt
mkdir -p /mnt/home
mount /dev/mapper/vgcrypt-home /mnt/home
</code></pre>
<p>Lets also mount our boot partition, while we're here. This is required so our
bootable initramfs can be written to the boot drive:</p>
<pre><code class="language-bash">mkdir -p /mnt/boot
mount /dev/sda1 /mnt/boot
</code></pre>
<p>If you're interested in swap partition schemes,
<a href="https://github.com/NoviceLive/unish/blob/master/doc/arch-install.sh#L127">check this script out</a>
− although I'm fine without swap partitions (Its faster with enough RAM).</p>
<p>And with that, Arch is now ready to be installed on the disk.</p>
<h3>Select a Mirror</h3>
<p>This step can optionally be skipped, but I prefer to choose a US server just in
case it may be faster. Open up the mirrorlist:</p>
<pre><code class="language-bash">vi /etc/pacman.d/mirrorlist
</code></pre>
<p>Delete or comment out all the servers except one or two near you that seem good.</p>
<h3>Install the Base System</h3>
<p>Actually installing Arch Linux onto the drive is the easiest part:</p>
<pre><code class="language-bash">pacstrap -i /mnt base base-devel terminus-font
</code></pre>
<p>The <code>-i</code> flag asks for confirmation before installing packages. I like using it
just so I can see what’s being installed. (After all that's part of the reason
for using GNU/Linux, right? To know what’s being installed on your system.)</p>
<p>This installation includes <code>terminus-font</code>, which we'll configure to be the
default console font later on.</p>
<h3>Generate the fstab</h3>
<p>If all went according to plan, Arch has been written to the hard drive and is
now installed. Before rebooting into our installation, though, we need to tell
the system where to find the filesystems we created earlier for root and home
directories.</p>
<p>While it’s normally a good idea to use UUIDs to find disks, we’re going to use
labels. This is because our encryption setup generates random IDs for the disks
when they’re decrypted. Let’s create the <code>fstab</code> file:</p>
<pre><code class="language-bash">genfstab -L -p /mnt >> /mnt/etc/fstab
</code></pre>
<p>The <code>-L</code> flag will generate the fstab file with labels instead of UUIDs. The
<code>-p</code> flag prevents pseudo-filesystems from being added.</p>
<p>Always check the generated fstab:</p>
<pre><code class="language-bash">cat /mnt/etc/fstab
</code></pre>
<p>It should look something like this:</p>
<pre><code>#
# /etc/fstab: static file system information
#
# &#x3C;file system>    &#x3C;dir>&#x3C;type>&#x3C;options>             &#x3C;dump>&#x3C;pass>
# /dev/mapper/vgcrypt-root
/dev/mapper/vgcrypt-root    /           ext4   discard,rw,relatime,data=ordered    0 1

# /dev/mapper/vgcrypt-home
/dev/mapper/vgcrypt-home    /home       ext4   discard,rw,relatime,data=ordered    0 2
</code></pre>
<p><strong>Note</strong> If your hard drive is a solid-state drive (SSD) and the <code>discard</code>
option isn’t there, edit the fstab file and add it. It's used for optimizing for
the speed of SSDs.</p>
<h3>Configure The System</h3>
<p>We’re now ready to configure our new system. Let’s change root into it:</p>
<pre><code class="language-bash">arch-chroot /mnt /bin/bash
</code></pre>
<p>Set our system locale. I'm in the US, so I'll only uncomment that locale from
<code>/etc/locale.gen</code>:</p>
<pre><code>...
en_US.UTF-8 UTF-8
en_US ISO-8859-1
...
</code></pre>
<p>Now generate the locales:</p>
<pre><code class="language-bash">locale-gen
</code></pre>
<p>Make English UTF-8 the default:</p>
<pre><code class="language-bash">echo LANG=en_US.UTF-8 > /etc/locale.conf
</code></pre>
<p>The default font in the virtual console is not very readable, so lets use one
that is far more readable. We're going to use the typeface "Terminus" in size 18
that we installed with the base system earlier. <code>ter-118n</code> basically means
"Terminus latin-1 size 18 Normal". There are other sizes available: 12, 14, 16,
20, 22, 24, 28, 32 as well as support for multiple non-English code pages.</p>
<pre><code class="language-bash">echo FONT=ter-118n > /etc/vconsole.conf
</code></pre>
<p>Set the timezone accordingly. (I live on the east coast):</p>
<pre><code class="language-bash">ln -sf /usr/share/zoneinfo/America/New_York /etc/localtime
</code></pre>
<p>And set the time to the standard UTC:</p>
<pre><code class="language-bash">hwclock --systohc --utc
</code></pre>
<p>Because we've encrypted our root disk, we need to make sure the kernel loads the
proper modules to decrypt it on startup. Otherwise we won’t be able to boot from
the unencrypted drive. We're also going to tell the boot-sequence to load our
custom font and keyboard module so we can type our passwords during boot. Edit
<code>/etc/mkinitcpio.conf</code> and add the hooks <code>consolefont keyboard encrypt lvm2</code>
<strong>BEFORE</strong> <code>filesystems</code> so the HOOKS line looks like this:</p>
<pre><code>HOOKS="base udev autodetect modconf block consolefont keyboard usbinput encrypt lvm2 filesystems fsck"
</code></pre>
<p>Now we need to regenerate the initramfs image:</p>
<pre><code class="language-bash">mkinitcpio -p linux
</code></pre>
<p>So that Internet will work on reboot, we need to enable the <code>dhcpcd</code> service.
We’re going to keep using the ethernet-USB adapter for right now. We'll get
wireless setup later. Get the name of the ethernet interface:</p>
<pre><code class="language-bash">ip link
</code></pre>
<p>It should be <code>enp</code>-something. With that, enable the service, make sure you
replace INTERFACE with your interfaces name.</p>
<pre><code class="language-bash">systemctl enable dhcpcd@INTERFACE.service
</code></pre>
<p>Finally, let’s configure the machine’s hostname. You can change <code>macbook</code> to
whatever you'd like:</p>
<pre><code class="language-bash">echo macbook > /etc/hostname
</code></pre>
<p>Add this hostname to the list of hosts. Edit <code>/etc/hosts</code> and edit so it looks
something like this:</p>
<pre><code>#
# /etc/hosts: static lookup table for host names
#

#&#x3C;ip-address>   &#x3C;hostname.domain.org>   &#x3C;hostname>
127.0.0.1   localhost.localdomain   localhost   macbook
::1     localhost.localdomain   localhost   macbook
</code></pre>
<p>Set a root password:</p>
<pre><code class="language-bash">passwd
</code></pre>
<p>Create a non-root user for yourself and set the user’s password, replace USER
with the username of your choosing:</p>
<pre><code class="language-bash">useradd --create-home --groups wheel --shell /bin/bash USER
passwd USER
</code></pre>
<p>This will create the user, add it to the group wheel (traditional group of users
who can run <code>sudo</code> commands), create a home directory under <code>/home/USER/</code> and
make his default shell <code>bash</code> then set a default password for the user.</p>
<p>Don't switch to the new user yet, because we'e added USER to the group <code>wheel</code>,
lets grant the wheel group <code>sudo</code> privileges. Run:</p>
<pre><code class="language-bash">visudo
</code></pre>
<p>And uncomment the following line so it looks like so:</p>
<pre><code>%wheel ALL=(ALL) ALL
</code></pre>
<h3>Boot Loader</h3>
<p>Now we need to let the boot loader know where to find our new Arch Linux
installation. <code>systemd</code> (was recently renamed, was Gummiboot) is a nice, simple
boot loader.</p>
<pre><code class="language-bash"># pacman -S systemd              # May be systemd-boot, included in core?
mkdir -p /boot/loader/entries
</code></pre>
<p>Setup the loader to default to arch and set the number of seconds to timeout in
the file <code>/boot/loader/loader.conf</code>:</p>
<pre><code class="language-bash">default arch
timeout 3
</code></pre>
<p>Make sure the correct boot partition (<code>/dev/sda1</code> in my case) is mounted on
<code>/boot</code> by running:</p>
<pre><code>findmnt /boot
-------------------------
TARGET SOURCE    FSTYPE OPTIONS
/boot  /dev/sda1 vfat   rw,relatime,fmask=0022,dmask=0022,codepage=437,iocharset=iso8859-1,shortname=mixed,err
</code></pre>
<p>Now we’re going to create an entry called <code>/boot/loader/entries/arch.conf</code> that
looks like this:</p>
<pre><code># /boot/loader/entries/arch.conf
title   Arch Linux
linux   /vmlinuz-linux
initrd  /initramfs-linux.img
options cryptdevice=/dev/sdaX:vgcrypt:allow-discards root=/dev/mapper/vgcrypt-root rw
</code></pre>
<p><strong>Note</strong>:<sup><a href="#user-content-fn-7" id="user-content-fnref-7" data-footnote-ref aria-describedby="footnote-label">3</a></sup> On the options
line, make sure you replace <code>/dev/sdaX</code> with the path to the encrypted linux
partition we previously created on your device (It was <code>/dev/sda5</code> in this
guide). Additionally, if your drive is <em>not</em> a SSD, make sure to remove
<code>:allow-discards</code>.</p>
<p><strong>Note</strong>:<sup><a href="#user-content-fn-9" id="user-content-fnref-9" data-footnote-ref aria-describedby="footnote-label">4</a></sup> Its been reported
by some users that when booting to USB, the USB drive is assigned device id
<code>/dev/sda</code> and the hard drive to <code>/dev/sdb</code>. When rebooting without USB drive
(boot to new encrypted linux drive partition), the hard drive is reassigned to
device id <code>/dev/sda</code> which may invalidate the above <code>arch.conf</code> boot loader
entry. In this case, the encrypted linux partition will not boot because the
boot loader config <code>arch.conf</code> is configured to boot from <code>/dev/sdb</code>. In this
case you can reboot to USB again, and edit the options line in <code>arch.conf</code> to
read <code>/dev/sdaX</code>. Replace X with your partition id.</p>
<p>Check the boot tree with <code>tree /boot/</code> (If <code>tree</code> isn’t installed, install it
with <code>pacman -S tree</code>). It should look something like this:</p>
<pre><code>/boot/
├── EFI
│   ├── APPLE
│   │   └── EXTENSIONS
│   │       └── Firmware.scap
│   ├── Boot
│   │   └── BOOTX64.EFI
│   └── gummiboot
│       └── gummibootx64.efi
├── initramfs-linux-fallback.img
├── initramfs-linux.img
├── loader
│   ├── entries
│   │   └── arch.conf
│   └── loader.conf
└── vmlinuz-linux
</code></pre>
<p><strong>Note</strong>: At this point, you may want to enable suspend-to-disk (No power
consumption aka "Hibernate" mode). I've chosen not to enable this functionality,
but if you're interested, you can
<a href="http://loicpefferkorn.net/2015/01/arch-linux-on-macbook-pro-retina-2014-with-dm-crypt-lvm-and-suspend-to-disk/#suspend-to-disk-uswsusp:385892e3ac2613dca78d22bd09dbae7d">read about it here</a>.</p>
<p>Now we can have the bootloader write the initramfs onto the boot partition using
<code>bootctl</code>, part of the systemd-boot package.</p>
<pre><code class="language-bash">bootctl install
</code></pre>
<h3>Reboot into New Installation</h3>
<p>Let’s leave the chroot environment we used for the install:</p>
<pre><code>exit
</code></pre>
<p>You can umount and close the encrypted volume:</p>
<pre><code class="language-bash">umount -R /mnt
cryptsetup close vgcrypt
</code></pre>
<p>It’s not a bad idea to just double check the encryption to make sure it opens
and mounts properly:</p>
<pre><code class="language-bash">cryptsetup open /dev/sda5 vgcrypt
mount /dev/mapper/vgcrypt /mnt
</code></pre>
<p>If all goes accordingly, you can unmount and close the encryption again. And
finally…</p>
<pre><code class="language-bash">reboot
</code></pre>
<p>On reboot you should be greeted with the boot menu. After selecting Arch (or
waiting for it to timeout), you should be prompted for your password to decrypt
the drive, and then it should boot into the console.</p>
<h2>Configuring Arch</h2>
<p>You should now be running Arch Linux! Lets customize it and make it more useful.</p>
<h3>Install an Arch User Repository Package Manager</h3>
<p>Now we're about to dive deep into customizing Arch Linux installation with the
utilities and application we'll be using on a day-to-day basis. To facilitate
installing packages from the wider Arch User Repository (AUR), we'll install a
utility named <code>yaourt</code>. You can (of course) maintain AUR package installations
manually, but I like a helper to help me manage them. yaourt is like the
Homebrew of Arch Linux. I use
<a href="https://wiki.archlinux.org/index.php/Yaourt">yaourt</a> because it’s easy to
install, takes the same optional flags as <code>pacman</code>, and works well.</p>
<p>You need to use the "official" and manual way of installing AUR packages to get
yaourt installed. It also requires <code>package-query</code> from the AUR, so we’re going
to install that first.</p>
<p>Now we’re going to download the <code>package-query</code> AUR package, unarchive it, and
use pacman to build and install the package. This allows us to manage the
package as if it was installed with pacman, although we're manually installing
it.</p>
<pre><code class="language-bash">$ cd ~
$ curl -L -O https://aur.archlinux.org/cgit/aur.git/snapshot/package-query.tar.gz
$ tar -xvzf package-query.tar.gz
$ cd package-query
</code></pre>
<p>Within the packages' folder, we’re going to run the following to build it:</p>
<pre><code class="language-bash">$ makepkg -s
</code></pre>
<p>This will run as your regular user only asking you for your root password if
necessary. With the package made, we can install it via pacman:</p>
<pre><code class="language-bash"># pacman -U package-query-1.6.2-1-x86_64.pkg.tar.xz
</code></pre>
<p>Now we’ll do the same for yaourt:</p>
<pre><code class="language-bash">$ cd ~
$ curl -L -O https://aur.archlinux.org/cgit/aur.git/snapshot/yaourt.tar.gz
$ tar -xvzf yaourt.tar.gz
$ cd yaourt
$ makepkg -s
# pacman -U yaourt-1.6-1-any.pkg.tar.xz
</code></pre>
<p>From now on you can use <code>pacman</code> and <code>yaourt</code> interchangeably… for the most
part. <code>yaourt</code> will install Arch repository packages and AUR packages. <code>pacman</code>,
though, will continue to only install Arch repository packages.</p>
<h3>Configure Sound</h3>
<p>ALSA works out of the box with Macs so install it via:</p>
<pre><code class="language-bash"># pacman -S alsa-utils
</code></pre>
<p>Then use:</p>
<pre><code class="language-bash">alsamixer
</code></pre>
<p>to control the speakers. Make sure to disable channels for speakers you don't
have. Test your speakers with:</p>
<pre><code class="language-bash">speaker-test -c 2
</code></pre>
<p>where 2 is the number of speakers.</p>
<h3>Install X and Video Drivers</h3>
<p>As this is going to be a graphical interface, we need are graphics card up and
running with the proper drivers. Luckily this machine uses Intel graphics, and
Intel is pretty good about providing Linux (and sometimes open-source) drivers.</p>
<p>For Macbookpro 7,1 (Mid-2010 or 8,2 (Early-2011):</p>
<pre><code class="language-bash"># pacman -S xf86-video-intel mesa-libgl libva-intel-driver libva
</code></pre>
<p>For Macbookpro 11,3
(Late-2013)<sup><a href="#user-content-fn-8" id="user-content-fnref-8" data-footnote-ref aria-describedby="footnote-label">5</a></sup></p>
<pre><code class="language-bash"># pacman -S nvidia mesa-libgl libva-intel-driver libva
</code></pre>
<p>The <code>-S</code> flag tells pacman to install the subsequent packages listed. (Again,
you can use yaourt if you’d like.) This will install the Intel video driver, the
Mesa OpenGL graphics library, and video acceleration API for Intel graphics
chipsets. It'll likely ask you to install additional dependencies. Get all the
dependencies!</p>
<p>With the necessary drivers installed, we can get Xorg (or the X Window System)
installed.</p>
<pre><code class="language-bash"># pacman -S xorg-server xorg-server-utils xorg-xinit xterm
</code></pre>
<p>I like to install the Xorg utilities, too, because there are at least a couple
I'll use later (either in this guide or another) that are helpful in improving
HiDPI support for the MacBook’s HiDPI Retina display.</p>
<h3>Some GUI Applications</h3>
<p>Next we'll install a browser. This will install some typeface dependencies and
font- rendering libraries that we'll be tweaking later.</p>
<pre><code class="language-bash"># pacman -S firefox
</code></pre>
<h3>Improved Typography</h3>
<p><strong>Update<sup><a href="#user-content-fn-10" id="user-content-fnref-10" data-footnote-ref aria-describedby="footnote-label">6</a></sup></strong></p>
<p><strong>It appears
<a href="https://github.com/bohoomil/fontconfig-ultimate/issues/191">the package maintainer for Infinality has gone dark</a></strong>.
Skip this section and <a href="#window-manager-awesome">continue to the next</a> until
there is a solution for better typography on the linux desktop.</p>
<p>If you use the web and appreciate typography, you'll want to install a set of
decent fonts.</p>
<p>Infinality is a package group that has been meticulously crafted from the
ground-up to provide beautifully rendered typography to the Linux platform. The
package maintainer spent a ton of time tearing down the existing font stack, and
carefully rebuilding it to provide fast-rendering fonts that more faithfully
present the typography than either Windows, OS X or Ubuntu systems. It also
provides a set of preset-configurations that allow the user to switch to a
Windows-like or OS X-like configuration. I highly recommend
<a href="http://bohoomil.com/doc/">reading the documentation</a> if you'd like to know more
about typography rendering on GNU/Linux.</p>
<p>First add the following package repositories to <code>/etc/pacman.conf</code>.</p>
<pre><code>[infinality-bundle]
Server = http://bohoomil.com/repo/$arch
[infinality-bundle-fonts]
Server = http://bohoomil.com/repo/fonts
</code></pre>
<p>Next we'll add the
<a href="https://bbs.archlinux.org/viewtopic.php?id=162098">package maintainers PGP key</a>
to the package database, update the package database and install the packages.</p>
<pre><code class="language-bash"># pacman-key -r 962DDE58
# pacman-key --lsign-key 962DDE58
# pacman -Syyu
# pacman -S infinality-bundle
# pacman -S infinality-bundle-fonts
</code></pre>
<p>Make sure to select the option <code>fontconfig-infinality-ultimate</code> as that
configuration
<a href="http://bohoomil.com/doc/01-overview/">is the most clean, efficient and looks the best out of the box</a>.
The installation may ask to use the Infinality packages in place of the
dependencies installed by Firefox. Choose the Infinality packages.</p>
<p>To enable selection of predefined font substitution styles and antialiasing
settings, apart from the rendering settings of the engine itself. After doing
so, you can select the font style (win7, winxp, osx, linux, ...) with:</p>
<pre><code class="language-bash"># fc-presets set
</code></pre>
<h3>Window Manager Awesome</h3>
<p>Awesome is a tiling window manager for the user that prefers keyboard commands
to mouse or touchpad, and treats window chrome as needless ornamentation. Your
application content is king, and efficiency is the goal. Its quick and light.
Lets install the window manager (WM), awesome.</p>
<p>To install:</p>
<pre><code class="language-bash"># pacman -S awesome
</code></pre>
<p>Added this<sup><a href="#user-content-fn-5" id="user-content-fnref-5" data-footnote-ref aria-describedby="footnote-label">7</a></sup> to run <code>awesome</code>
when x starts:</p>
<pre><code>echo exec awesome > .xinitrc
</code></pre>
<h3>Touchpad Support</h3>
<p>You’ll probably want to use your MacBook’s touchpad when you have a GUI. The
simplest driver is the synaptics driver:</p>
<pre><code class="language-bash"># pacman -S xf86-input-synaptics
</code></pre>
<p>The following config at /usr/share/X11/xorg.conf.d/70-synaptics.conf works well
for me, it uses the same "Natural Motion" that OS X does. Copy that file to the
following location <code>/etc/X11/xorg.conf.d/70-synaptics.conf</code> and add the options
between the <code>START</code> and <code>END</code> comments.</p>
<pre><code>Section "InputClass"
    MatchIsTouchpad "on"
    Identifier      "touchpad catchall"
    Driver          "synaptics"

    # START: Add these options
    # 1 = left, 2 = right, 3 = middle
    Option          "TapButton1" "1"
    Option          "TapButton2" "3"
    Option          "TapButton3" "2"
    # Palm detection
    Option          "PalmDetect" "1"
    # Horizontal scrolling
    Option "HorizTwoFingerScroll" "1"
    Option "VertTwoFingerScroll" "on"
    # Natural Scrolling (and speed)
    Option "VertScrollDelta" "-450"
    Option "HorizScrollDelta" "-450"
    # END
EndSection
</code></pre>
<h3>Configuring Wireless</h3>
<p>Before rebooting into our lovely new GUI, let's get wireless setup to work when
we reboot.</p>
<p>This particular machine has the Broadcom BCM4360 wireless chipset. Broadcom has
been pretty mixed in the FLOSS support it seems. The BCM4360 is not supported by
the kernel itself, so we’ll need to use Broadcom’s non-free, non-open driver:
<code>broadcom-wl</code>. I actually don’t think this even officially supports the BCM4360
chipset, but it works well enough. We’ll need to install the AUR package:</p>
<pre><code class="language-bash">$ yaourt -S broadcom-wl dialog wpa_supplicant
</code></pre>
<p>And activate the kernel module:</p>
<pre><code class="language-bash"># modprobe wl
</code></pre>
<p><strong>Note</strong>: If you update to a newer kernel in the future, you may need to
uninstall and reinstall the <code>broadcom-wl</code> package so it updates with the new
linux-header.</p>
<p>We need to stop the dhcpcd service we were using for the ethernet and start the
<code>wifi-menu</code><sup><a href="#user-content-fn-1" id="user-content-fnref-1-2" data-footnote-ref aria-describedby="footnote-label">1</a></sup> utility.
Keeping both running can cause conflicts.</p>
<pre><code class="language-bash"># systemctl disable dhcpcd.service
# wifi-menu
</code></pre>
<p>This will create and enable a systemd service that will start when the computer
boots. Changes to the profile file will not propagate to the service file
automatically. After such changes, it is necessary to reenable the profile:</p>
<pre><code class="language-bash"># netctl reenable PROFILE
</code></pre>
<p>After enabling a profile, it will be started at next boot.</p>
<p>Finally, if you find your wireless is dropping connections, you may find turning
off Wi-Fi power management. Simply create this as an executable ( chmod +x
<code>/etc/pm/wireless</code> and add the following contents:</p>
<pre><code>#!/bin/sh
iwconfig wlp2s0 power off
</code></pre>
<h3>Done!</h3>
<p>Now when you reboot, you should be all set to go start customizing to your
heart’s content, adding applications as you’d like, and playing around with your
new Arch Linux box with Awesome.s</p>
<h2>Fine Tuning</h2>
<p>Power settings took quite a bit of tweaking. Without these setting, the laptop
ran very hot, and drained battery life very fast. I would recommend following
these steps to improve battery life. There still may be room for improvement,
though.</p>
<p>One more thing: If you search "MacBook Pro and Arch Linux" you’ll probably read
some things about disabling ACPI interrupts that were causing overheating and
high CPU usage. If you have updated to the latest version of OS X 10.10
"Yosemite" then you should be OK to skip.</p>
<h3>Display Color Profile</h3>
<p>I noticed that colors seemed washed-out in Arch Linux, so this task will attempt
to color-correct the display. Luckily a utility <code>xcalib</code> exists that can load
color profiles from OS X as X options. This should give you true color-parity
between operating systems.</p>
<p>First, boot into OS X and copy the color profiles located in
<code>/Library/ColorSync/Profiles/Displays</code> to somewhere so you can boot into
GNU/Linux and copy them into your home directory. I created a directory named
<code>~/.colorprofiles</code> for these files.</p>
<p>Second, install the <code>xcalib</code> package from the Arch AUR.</p>
<pre><code class="language-bash">yaourt -S xcalib
</code></pre>
<p>Finally you can activate it by running:</p>
<pre><code class="language-bash">xcalib ~/.colorprofiles/FILENAME.icc
</code></pre>
<p>Where <code>FILENAME</code> is the path to your color profile file.</p>
<p>To load this color profile when X starts, I also added this command to the
<code>.xinitrc</code> file in my home directory. Just make sure you replace <code>FILENAME</code> with
the name of your color-profile <code>.icc</code> file exported from OS X.</p>
<pre><code class="language-bash">if [ `type -P xcalib` ]; then
  # Use the color profile
  xcalib ~/.colorprofiles/FILENAME.icc
fi;
</code></pre>
<h3>Display Color Correction</h3>
<p>If you spend as many hours looking at the display as I do, you'll quickly
appreciate a display that adapts its colors to the time of day.
<a href="https://justgetflux.com">F.lux</a> adjusts monitor color temperature adaptively to
ease eye strain.</p>
<pre><code class="language-bash">yaourt -S xfluxd
</code></pre>
<p>Then edit <code>/etc/xfluxd.conf</code> to set your rough lat/long coordinates (in decimal
format) in order to correctly shift the color correction with the sunrise and
sunset.</p>
<p>Finally, enable and start the <code>xfluxd</code> service. <strong>Note</strong> you should run this as
your normal user, not as root.</p>
<pre><code class="language-bash">systemctl enable --user xfluxd
systemctl start --user xfluxd
</code></pre>
<h3>Power Management</h3>
<p>The power management from Arch out of the box is not very good. There are a few
good tools out there, but <code>PowerTOP</code> is nice because of its benchmarking
utilities<sup><a href="#user-content-fn-2" id="user-content-fnref-2" data-footnote-ref aria-describedby="footnote-label">8</a></sup>.</p>
<blockquote>
<p>PowerTOP is a tool provided by Intel to enable various powersaving modes in
userspace, kernel and hardware. It is possible to monitor processes and show
which of them are utilizing the CPU and wake it from its Idle-States, allowing
you to identify applications with particular high power demands.</p>
</blockquote>
<pre><code class="language-bash">yaourt -S powertop
</code></pre>
<p>You may want to put your laptop on battery power and calibrate powertop:</p>
<pre><code class="language-bash"># powertop --calibrate
</code></pre>
<p>That’ll cause the screen to blackout from time to time. Just let it run. It
takes a few minutes then your screen will come back on.</p>
<p>You can create a systemd service that will launch powertop's autotune settings
on startup.</p>
<pre><code># /etc/systemd/system/powertop.service

[Unit]
Description=Powertop tunings

[Service]
Type=oneshot
ExecStart=/usr/bin/powertop --auto-tune

[Install]
WantedBy=multi-user.target
</code></pre>
<p>And enable it to automatically start at boot time, then start it for your
current boot session.</p>
<pre><code class="language-bash"># systemctl enable powertop.service
# systemctl start powertop.service
</code></pre>
<h3>Laptop Mode Tools</h3>
<p>Laptop Mode Tools<sup><a href="#user-content-fn-6" id="user-content-fnref-6" data-footnote-ref aria-describedby="footnote-label">9</a></sup> is a
laptop power saving package for Linux systems. It is the primary way to enable
the Laptop Mode feature of the Linux kernel, which allows you to tweak a number
of other power-related settings using a simple configuration file. Combined with
<code>acpid</code> and CPU frequency scaling, LMT provides a complete notebook power
management suite.</p>
<pre><code class="language-bash">$ yaourt -S laptop-mode-tools
</code></pre>
<p>If you want to enable laptop mode even on AC power, because you run the laptop
attached to an external keyboard and monitor, edit:</p>
<pre><code># /etc/laptop-mode/laptop-mode.conf`:
...
ENABLE_LAPTOP_MODE_ON_AC=1
...
ENABLE_LAPTOP_MODE_WHEN_LID_CLOSED=1
</code></pre>
<p>We're going to disable LMT from handling CPU frequency scaling since we've setup
<code>cpupower</code> to handle that:</p>
<pre><code># /etc/laptop-mode/conf.d/cpufreq.conf
...
# CONTROL_CPU_FREQUENCY="AUTO"
CONTROL_CPU_FREQUENCY=0
</code></pre>
<p>and disable Intel pstate handling as well:</p>
<pre><code># /etc/laptop-mode/conf.d/intel_pstate.conf
# CONTROL_INTEL_PSTATE="auto"
CONTROL_INTEL_PSTATE=0
</code></pre>
<p>Finally, enable and start the systemd service:</p>
<pre><code class="language-bash"># systemctl enable laptop-mode.service
# systemctl start  laptop-mode.service
</code></pre>
<h3>acpid</h3>
<p>A very useful tool is from the <code>acpi</code> package, which provides battery
information using the command <code>acpi -v</code>. To install:</p>
<pre><code class="language-bash"># pacman -S acpi
</code></pre>
<p><code>acpid</code> is an extensible daemon for handling ACPI events. It can run commands
when the laptop lid is closed, etc.</p>
<pre><code class="language-bash"># pacman -S acpid
# systemctl enable acpid.service
# systemctl start  acpid.service
</code></pre>
<h3>CPU Frequency Scaling</h3>
<p>Another utility that will help with CPU frequency scaling is <code>cpupower</code>, it
provides useful CLI utilities and a systemd service to change the CPU governor
at boot.</p>
<pre><code class="language-bash">$ yaourt -S cpupower
# systemctl enable cpupower
# systemctl start cpupower
</code></pre>
<p>I use cpupower to modulate the CPU’s speeds. This keeps CPU in check from maxing
out at all times. My cpupower config file at <code>/etc/default/cpupower</code> has the
following line changed:</p>
<pre><code>governor='powersave'
</code></pre>
<p>You should adjust this setting to your own needs.</p>
<h3>Temperature Management</h3>
<p>Intel provides a daemon that will keep tabs on the CPUs’ temperature and adjust
settings to keep it from getting too hot, its called <code>thermald</code>.</p>
<pre><code class="language-bash">$ yaourt -S thermald
# systemctl enable thermald.service
# systemctl start thermald.service
</code></pre>
<h3>Fan Control</h3>
<p>Finally, the kernel doesn’t seem to have very fine control over the MacBook’s
fan. The following script helps add fine-tuning for the fan that will increase
its baseline speed and ramp it up gently, so it’s not an all-or-nothing kind of
setup.</p>
<pre><code class="language-bash">$ yaourt -S mbpfan-git
# systemctl enable mbpfan.service
# systemctl start mbpfan.service
</code></pre>
<p>By default the service runs in verbose mode which adds tons of output to the
system journal. It basically works by measuring the CPU temp, adjusting the fan
speed accordingly, and then sleeping for a given number of seconds. With verbose
mode on, it logs its wakeup every few seconds. That means a lot of writing to
the journal. So I changed the service under
<code>/usr/lib/systemd/system/mbpfan.service</code> so the following line reads like so:</p>
<pre><code>ExecStart=/usr/sbin/mbpfan -f
</code></pre>
<h3>Apple Keyboard</h3>
<p>To get the <code>fn</code> keys working in X, we will install <code>xbindkeys</code> which helps bind
keyboard keys to commands. We will bind keys for volume, keyboard and display
brightness.</p>
<pre><code>```bash
# pacman -S xbindkeys
yaourt -S xorg-xbacklight kbdlight
```
</code></pre>
<p>Create your configuration file for xbindkeys: <code>.xbindkeysrc</code></p>
<pre><code># Increase volume 5% with Apple volume up
"amixer set Master playback 5%+"
    m:0x0 + c:123
    XF86AudioRaiseVolume
# Increase volume 5% with F12
"amixer set Master playback 5%+"
    m:0x0 + c:96


# Decrease volume 5% with Apple volume down
"amixer set Master playback 5%-"
    m:0x0 + c:122
    XF86AudioLowerVolume
# Decrease volume 5% with F11
"amixer set Master playback 5%-"
    m:0x0 + c:95


# Mute with Apple mute
"amixer set Master toggle"
    m:0x0 + c:121
    XF86AudioMute
# Mute with F10
"amixer set Master toggle"
    m:0x0 + c:76


# Suspend system
"systemctl suspend"
    m:0x0 + Mod4 + c:107
    Mod4 + XF86Eject


# Dim keyboard
"kbdlight down"
    m:0x0 + c:237
    XF86KbdBrightnessUp


# Brighten keyboard
"kbdlight up"
    m:0x0 + c:238
    XF86KbdBrightnessDown
</code></pre>
<p>Next we'll auto-start xbindkeys when X starts, add this to your <code>.xinitrc</code> file:</p>
<pre><code class="language-bash">if [ `type -P xbindkeys` ]; then
  # Load custom keyboard key bindings
  xbindkeys
fi;
</code></pre>
<h3>Apple Trackpad</h3>
<p>Finally<sup><a href="#user-content-fn-3" id="user-content-fnref-3" data-footnote-ref aria-describedby="footnote-label">10</a></sup>, we'll setup a
Bluetooth Apple Trackpad. To do this, we'll install some bluetooth core
utilities</p>
<pre><code class="language-bash"># pacman -S bluez bluez-utils
# modprobe btusb  # Make sure bluetooth kernel module is loaded
# systemctl enable bluetooth.service  # Start bluetooth on reboot
# systemctl start bluetooth.service
</code></pre>
<p>To actually connect to the Trackpad, we'll use the <code>bluetoothctl</code> interactive
utility to scan-for, discover, pair and connect to the Trackpad. (If your
Trackpad is already paired with another device, make sure to turn it off, then
long-hold the power button until the LED flashes.)</p>
<pre><code>$ bluetoothctl
> power on
> scan on
> agent on
> devices    # You should see the MAC address of your Trackpad appear if its in discoverable mode
> pair mac 28:37:37:2B:42:7A
> connect 28:37:37:2B:42:7A
</code></pre>
<p>Then we'll setup some <code>udev</code> rules so USB Bluetooth is activated and loade when
the system boots up.</p>
<pre><code># /etc/udev/rules.d/10-local.rules
# Set bluetooth power up
ACTION=="add", KERNEL=="hci0", RUN+="/usr/bin/hciconfig hci0 up"
</code></pre>
<h2>Conclusion</h2>
<p>Wrapping up, I have nothing to add other than what you do with your system is up
to you.</p>
<h2>References</h2>
<p>The following articles were very useful in providing some help and inspiration.</p>
<ul>
<li><a href="https://mchladek.me/post/arch-mbp/">Installing Arch Linux on a MacBook Pro - Michael Chladek</a></li>
<li><a href="http://zanshin.net/2015/02/05/arch-linux-on-a-macbook-pro-part-1-creating-a-usb-installer/">Introductory MacBook Arch Guide - Zanshin</a></li>
<li><a href="http://loicpefferkorn.net/2015/01/arch-linux-on-macbook-pro-retina-2014-with-dm-crypt-lvm-and-suspend-to-disk/">Arch Linux on MacBook Pro Retina 2014 with DM-Crypt, LVM and suspend to disk - Loïc Pefferkorn</a></li>
<li><a href="https://wiki.archlinux.org/index.php/MacBook">ArchWiki MacBook</a></li>
<li><a href="https://wiki.archlinux.org/index.php/MacBookPro11,x">ArchWiki MacBookPro11,x</a></li>
<li><a href="https://medium.com/@philpl/arch-linux-running-on-my-macbook-2ea525ebefe3#.ai90cnihe">Arch Linux Running on my MacBook - Phil Plückthun</a></li>
<li><a href="https://www.youtube.com/watch?v=Fzmm87oVQ6c">My personal fight against the modern laptop</a></li>
</ul>
<p>Any changes to this article will be annotated with a footnote and explained
here.</p>
<section data-footnotes class="footnotes"><h2 class="sr-only" id="footnote-label">Footnotes</h2>
<ol>
<li id="user-content-fn-1">
<p>March 6, 2016: Previously used <code>NetworkManager</code> to detect
and connect to WiFi networks, but have changed to use
<code>netctl</code> and <code>wifi-menu</code> as these commands are
more low-level and have fewer dependencies. <a href="#user-content-fnref-1" data-footnote-backref class="data-footnote-backref" aria-label="Back to content">↩</a> <a href="#user-content-fnref-1-2" data-footnote-backref class="data-footnote-backref" aria-label="Back to content">↩<sup>2</sup></a></p>
</li>
<li id="user-content-fn-4">
<p>March 14, 2016: Thanks
<a href="https://www.reddit.com/r/archlinux/comments/493k4n/installing_encrypted_arch_linux_on_an_apple/d0y36h4?context=3">Fr0gm4n</a>
for suggestions simplifying the writing of <code>iso</code>
images to USB. <a href="#user-content-fnref-4" data-footnote-backref class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
<li id="user-content-fn-7">
<p>April 2, 2016: Thanks
<a href="https://www.reddit.com/r/archlinux/comments/493k4n/installing_encrypted_arch_linux_on_an_apple/d1mleow?context=3">Perceptes</a>
for helping to clarify the text explaining how to configure the bootloader. <a href="#user-content-fnref-7" data-footnote-backref class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
<li id="user-content-fn-9">
<p>December 2, 2016: Thanks to Joshua Brown for clarifications to writing the bootloader line. <a href="#user-content-fnref-9" data-footnote-backref class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
<li id="user-content-fn-8">
<p>July 28, 2016: Updated to support Macbookpro 11,3 devices with NVidia cards. This device uses NVIDIA GeForce GT 750M (Codename NVE7/GK107). <a href="#user-content-fnref-8" data-footnote-backref class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
<li id="user-content-fn-10">
<p>February 6, 2017: If anyone has a solution to the loss of Infinality bundle
typography, please drop me a line. <a href="#user-content-fnref-10" data-footnote-backref class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
<li id="user-content-fn-5">
<p>March 18, 2016: Changed references to <code>.Xinitrc</code> to the
correct filename, <code>.xinitrc</code>. <a href="#user-content-fnref-5" data-footnote-backref class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
<li id="user-content-fn-2">
<p>March 8, 2016: Previously omitted the <code>-S</code> option in
yaourt, fixed. <a href="#user-content-fnref-2" data-footnote-backref class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
<li id="user-content-fn-6">
<p>March 24, 2016: Added two new sections documenting Laptop Mode Tools
and <code>acpid</code>. <a href="#user-content-fnref-6" data-footnote-backref class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
<li id="user-content-fn-3">
<p>March 8, 2016: Added a section covering the Apple Trackpad. <a href="#user-content-fnref-3" data-footnote-backref class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
</ol>
</section>
</div><footer class="license_copyright__KOT7N">This is licensed under a Creative Commons <!-- -->cc-by-nc-sa<!-- --> International License</footer></article></main><div class="layout_layout__Xf50c"><footer class="footer_footer__OT4Wn layout_layout__Xf50c"><p>© 2003-<!-- -->2023<!-- --> 0xADADA (unless otherwise noted.)<br/><a title="0xADADA" href="/">Home</a> <span class="h-card"><a class="c-Meta u-email" rel="me" title="0xADADA" href="mailto:0xadada.pub@protonmail.com">Email</a> </span><a rel="me nofollow external noopener" title="0xADADA on Mastodon" href="https://freeradical.zone/@0xadada">Mastodon</a> <a rel="me nofollow external noopener" title="0xADADA on Twitter" href="https://twitter.com/0xadada">Twitter</a> <a rel="me nofollow external noopener" title="0xADADA on GitHub" href="https://github.com/0xadada">GitHub</a> <a rel="me nofollow external noopener" title="0xADADA on Goodreads" href="https://www.goodreads.com/review/list/60524683-0xadada?shelf=wanted">Goodreads</a> </p></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slugs":{"year":"2016","month":"03","day":"05","slug":"install-encrypted-arch-linux-on-apple-macbook-pro"},"title":"Installing (encrypted) Arch Linux on an Apple MacBook Pro","displayTitle":"Installing (encrypted) Arch Linux on an Apple MacBook Pro","metaDescription":"A howto guide for installing encrypted Arch Linux on an Apple MacBook Pro with battery optimization and the Awesome window manager.","metaKeywords":"Apple, MacBook, MacBook Pro, encryption, linux, Arch Linux, GNU/Linux,","date":1457177700000,"author":"0xADADA","content":"\u003cp\u003eIn the style of \u003ca href=\"https://mchladek.me/post/arch-mbp/\"\u003eMichael Chladek\u003c/a\u003e, I thought\nit would be useful to my future-self and others, if I wrote up a summary of\ninstalling Arch Linux on Apple MacBook hardware. Of course there are other\nguides out there, but this one is specific to the needs of someone looking for a\nminimalist, reproducible, secure, performance oriented installation of Arch\nLinux.\u003c/p\u003e\n\u003cp\u003eIn following this guide, I've made some decisions that are entirely based on my\nown (subjective) opinions. These opinions are based on my experiences with other\noperating systems and distros, and a number of window managers I've tried.\u003c/p\u003e\n\u003cp\u003eMy decisions (take them or leave them):\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDistribution: Arch Linux\u003c/li\u003e\n\u003cli\u003eFull disk encryption: On\u003c/li\u003e\n\u003cli\u003eWindow Manager: Awesome\u003c/li\u003e\n\u003cli\u003eTypography: infinality-bundle with the \"Free\" preset\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThis article assumes you're currently running on a MacBook Pro between\ngeneration 7,1 (Mid-2010), 8,2 (Early-2011) or 11,3 (Late-2013). It assumes\nyou're running OS X and already have some experience with Linux commands, disk\npartitions and GNU/Linux. I've tested this guide on both of the above\ngenerations, but I'm assuming it'll work on anything in between. However, I make\nno guarantees.\u003c/p\u003e\n\u003cp\u003eIf you just want to get on to the installation, skip to this link:\n\u003ca href=\"#installing-arch\"\u003eInstalling Arch\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eContents\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#background\"\u003eBackground\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#why-apple\"\u003eWhy Apple?\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#why-arch\"\u003eWhy Arch?\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#why-awesome\"\u003eWhy Awesome?\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#preparing-to-install-arch\"\u003ePreparing to Install Arch\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#getting-the-installation-media\"\u003eGetting the Installation Media\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#preparing-the-installation-usb-drive\"\u003ePreparing the Installation USB Drive\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#installing-arch\"\u003eInstalling Arch\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#test-internet\"\u003eTest Internet\u003c/a\u003e and\n\u003ca href=\"#set-the-system-clock\"\u003eSet the System Clock\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#partition-the-hard-drive\"\u003ePartition the Hard Drive\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#configuring-drive-encryption-and-lvm\"\u003eConfiguring Drive Encryption and LVM\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#select-a-mirror\"\u003eSelect a Mirror\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#install-the-base-system\"\u003eInstall the Base System\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#generate-the-fstab\"\u003eGenerate the fstab\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#configure-the-system\"\u003eConfigure The System\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#boot-loader\"\u003eBoot Loader\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#reboot-into-new-installation\"\u003eReboot into New Installation\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#configuring-arch\"\u003eConfiguring Arch\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#install-an-arch-user-repository-package-manager\"\u003eInstall an Arch User Repository Package Manager\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#configure-sound\"\u003eConfigure Sound\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#install-x-and-video-drivers\"\u003eInstall X and Video Drivers\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#some-gui-applications\"\u003eSome GUI Applications\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#improved-typography\"\u003eImproved Typography\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#window-manager-awesome\"\u003eWindow Manager Awesome\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#touchpad-support\"\u003eTouchpad Support\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#configuring-wireless\"\u003eConfiguring Wireless\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#done\"\u003eDone!\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#fine-tuning\"\u003eFine Tuning\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#display-color-profile\"\u003eDisplay Color Profile\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#display-color-correction\"\u003eDisplay Color Correction\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#power-management\"\u003ePower Management\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#laptop-mode-tools\"\u003eLaptop Mode Tools\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#acpid\"\u003eacpid\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#cpu-frequency-scaling\"\u003eCPU Frequency Scaling\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#temperature-management\"\u003eTemperature Management\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#fan-control\"\u003eFan Control\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#apple-keyboard\"\u003eApple Keyboard\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#apple-trackpad\"\u003eApple Trackpad\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#conclusion\"\u003eConclusion\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#references\"\u003eReferences\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#footnotes\"\u003eFootnotes\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThis article will be installing Arch Linux alongside OS X, dual-booting such\nthat you can easily boot into either. I recommend this, even if you’re not going\nto be using OS X at all, because right now (and likely for the foreseeable\nfuture) the only way to get firmware updates installed on your machine will be\nvia OS X. There have been Linux kernel–MacBook Pro firmware compatibility issues\nin the past that have been fixed by OS X updates that installed firmware fixes.\u003c/p\u003e\n\u003cp\u003eI assume you have already repartitioned your drive giving you plenty of free\nspace for Arch. On my 500GB drive, I left 80GB for OS X (probably much more than\nreally necessary) and the rest I left free for Arch.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eConventions\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eFor commands typed as the normal user, I will not prefix them:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003euname -a\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFor commands that need to be executed as a root account, i will prefix them with\na hash-mark: \u003ccode\u003e#\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# uname -a\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eBackground\u003c/h2\u003e\n\u003ch3\u003eWhy Apple\u003c/h3\u003e\n\u003cp\u003eI've been using OS X as my primary OS since 2011 when I bought my first Apple\nproduct, the 15\" MacBook Pro 8,2− which I still use today (March 2016, on which\nI'm writing this article). This alone is a testament to its' longevity as a\ncomputing platform. The industrial design of the hardware is a pleasure to the\neyes and is much imitated. The hardware feels wonderful to the touch. I've\ndisassembled a few of them, and despite the security screws, they're fairly easy\nto repair or upgrade. Only recently had I felt that its' age was starting to\nshow, so last week I doubled the ram from 8GB to 16GB and upgraded the hard\ndrive to a 512GB SSD. This should provide at least another two years of life for\nthis hardware.\u003c/p\u003e\n\u003cp\u003eRecently however, Apple has changed their hardware design philosophy from a\nfairly open platform to a more proprietary and disposable one. They've\neliminated the ability to change or upgrade components. The\n\u003ca href=\"https://en.wikipedia.org/wiki/MacBook_Pro#3rd_generation_.28Retina.29\"\u003e3rd generation MacBooks\u003c/a\u003e\nhave a battery that is glued in place, the memory is soldered directly to the\nlogic board. Later models would come with the hard drive soldered down as well.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://ifixit.org/blog/2763/the-new-macbook-pro-unfixable-unhackable-untenable/\"\u003eLyle Wiens of iFixIt, said it best in 2012\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWhen Apple dropped the MacBook Air to $999 in 2010 to match the price point\nof the MacBook, they gave users a clear choice: the thin, light, and\nun-upgradeable MacBook Air or the heavier, longer lasting, [upgradable], more\nrugged, and more powerful MacBook. Same price, two very different products. At\nthe time, I wasn’t very happy with the non-upgradeable RAM on the MacBook Air,\nbut I respected that Apple had given their users a choice. It was up to us:\nDid we want a machine that would be stuck with 2GB of RAM forever? Would we\nsupport laptops that required replacement every year or two as applications\nrequired more memory and batteries atrophied?\u003c/p\u003e\n\u003cp\u003eConsumers overwhelmingly voted yes, and the Air grew to take 40 percent of\nApple’s notebook sales by the end of 2010.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThis sort of vendor-lock down and\n\u003ca href=\"https://en.wikipedia.org/wiki/Planned_obsolescence\"\u003eplanned-obsolecence\u003c/a\u003e has\nbothered me to such an extent that the next laptop I buy won't be Apple\nhardware.\u003c/p\u003e\n\u003cp\u003eMeanwhile, Apple has secured an\n\u003ca href=\"https://en.wikipedia.org/wiki/Oligopoly\"\u003eoligopoly\u003c/a\u003e in the market, they have\nsuch a dominant position with hardware manufacturers that they seem to be\nsqueezing competitors out of getting access to top-quality components (or their\ncompetitors don't care about quality). These manufacturers seem to be building\ncomputers with \"Apples' scraps and leftovers\".\u003c/p\u003e\n\u003cp\u003ePut simply; I don't see any manufacturers building laptops at the same level of\nquality that Apple does, and yet, I can't buy a\nproduct\u003csup\u003e\u003ca href=\"#user-content-fn-1\" id=\"user-content-fnref-1\" data-footnote-ref aria-describedby=\"footnote-label\"\u003e1\u003c/a\u003e\u003c/sup\u003e that is so tightly\ncontrolled. Finally, I refuse to buy a product that is designed to be obsolete\nin two years.\u003c/p\u003e\n\u003ch3\u003eWhy Arch?\u003c/h3\u003e\n\u003cp\u003eI first started using Linux in 1997 when I bought a\n\u003ca href=\"https://upload.wikimedia.org/wikipedia/en/thumb/4/49/Redhat_5.2_box.jpg/220px-Redhat_5.2_box.jpg\"\u003eshrink-wrapped box of RedHat Linux 5.2\u003c/a\u003e.\nAt the time, my internet connection was fast but not reliable enough to download\nthe ISO image over a 1-day dial-up session. Since then I've tried Slackware,\nSuSE, Mandrake, Debian, Fedora, Ubuntu, CentOS, and Mint. I customized the hell\nout of my distros, I performance tweaked, secured and customized the GUI. Back\nthen, information was hard to come by, the community was still small and poorly\ndocumented, and that hardly mattered when I couldn't access the internet because\nmy ethernet card drivers wouldn't compile.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://medium.com/@fun_cuddles/linux-of-the-90s-or-why-i-have-linux-desktop-ptsd-1f276a7887fb#.jwg8up61m\"\u003eJen Andre sums it up best\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eYou kids these days. You have it easy.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eIt was enjoyable for a while, but I got very busy and eventually came to the\nconclusion that \"Linux is free if your time is worth nothing\" and stuck with OS\nX. I would occasionally install and try a different distro just to see if the\nOSS operating system world had changed, but that was about it.\u003c/p\u003e\n\u003cp\u003eArch is different however. Arch gets it, Arch gets it right. Arch is what I was\nsearching for all those years.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eA rolling release cycle keeps everything fresh\u003c/li\u003e\n\u003cli\u003eI'm a huge advocate for their KISS Principal: Keep it Simple…\u003c/li\u003e\n\u003cli\u003eThe documentation is widely regarded as the best source of info on GNU/linux\u003c/li\u003e\n\u003cli\u003eThe Core package repository is very well maintained and trusted\u003c/li\u003e\n\u003cli\u003eThe User package repository is great at providing pretty much everything you\ncould need or want\u003c/li\u003e\n\u003cli\u003eIts designed for people who want to understand and build a system from the\nground up. Install only what you know, only what you understand. It doesn't\nhide anything behind assumptions, scripts or fancy installers.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003e\n\u003cp\u003eArch is like a sandbox, they provide the box and a source of sand (the Core\nand User package repos), but it's up to you to fill it and build your castle.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3\u003eWhy Awesome?\u003c/h3\u003e\n\u003cp\u003eLike the topic of GNU/Linux distros, I could spend an entire post talking about\nwhy I settled on Awesome. I've tried GNOME, KDE, even Enlightenment. They all\nare trying to do more than I need, are too influenced by the design of the Big\nDesktop players and pander to novices at the expense of the power users.\u003c/p\u003e\n\u003cp\u003eAll I really need is a quick way to switch between windows and resize them as\nneeded and for it to be fast. The focus of the window manager is the application\ncontents, not the chrome eye-candy around the edges of the window.\u003c/p\u003e\n\u003cp\u003eAwesome was designed for this.\u003c/p\u003e\n\u003cp\u003eSo, this guide is going to install Awesome as it's window manager. Feel free to\nswitch it out for whatever you prefer. i3, xmonad and DWM are all similar in\ndesign.\u003c/p\u003e\n\u003ch2\u003ePreparing to Install Arch\u003c/h2\u003e\n\u003cp\u003eWhen doing this article, I found many other articles very useful. They are\nlisted in \u003ca href=\"#references\"\u003eReferences\u003c/a\u003e. Please refer to them if needed. I will\nattempt to both update and condense these articles to a single \"Be-all End-all\nGuide\" to MacBook installation.\u003c/p\u003e\n\u003ch3\u003eGetting the Installation Media\u003c/h3\u003e\n\u003cp\u003eFirst, we need to get Arch Linux ISO from Arch Linux,\n\u003ca href=\"https://www.archlinux.org/download/\"\u003eGo here to download it\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eI usually go with the torrent option. It's the fastest.\u003c/p\u003e\n\u003cp\u003eNext, we’re just going to make sure the download wasn’t corrupted or tampered\nwith in transit. To make this possible, the Arch Linux ISO publisher has posted\na cryptographic hash of the ISO. We can compare the hash of the ISO they\npublished against the hash of the ISO we downloaded. If the hash is identical,\nwe know the contents are exactly the same. Start the terminal and run the\nfollowing:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003esha1sum \u0026#x3C;FILE\u003e.iso\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNext, we want to make sure the the ISO we've downloaded is provably supplied by\nthe Arch Linux team. We can do this by verifying the cryptographic signature\nthey provided with the ISO. The Arch team cryptographically signs their ISO\nimages using public-key cryptography. This ensures that the ISO file we've\ndownloaded is verifiably provided by the Arch Linux team, and not an impostor.\u003c/p\u003e\n\u003cp\u003eThis assumes you have GnuPG installed on your system (\u003ccode\u003ebrew install gnupg\u003c/code\u003e). On\nthe ISO download page, there is a link under “Checksums” to get the PGP\nsignature as a \u003ccode\u003e.sig\u003c/code\u003e file. Download that into the same directory as your Arch\nISO. Then run the following, replacing the filename (here i use\n\u003ccode\u003earchlinux-2016-02-01-dual.iso\u003c/code\u003e) with the name of the files you've downloaded:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003egpg --verify \\\n    archlinux-2016.02.01-dual.iso.sig \\\n    archlinux-2016.02.01-dual.iso 2\u003e\u0026#x26;1 | \\\n    grep 'key ID' | \\\n    gpg --recv-keys 2\u003e\u0026#x26;1 `awk '{print $NF}'` \u0026#x26;\u0026#x26; \\\ngpg --verify archlinux-2016.02.01-dual.iso.sig \\\n    archlinux-2016.02.01-dual.iso 2\u003e\u0026#x26;1 | grep 'signature from'\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis will first attempt to verify the signature, and if you don't have the\nsigners key, it'll retrieve it. It'll then try to verify it again, and should\nprint out \"Good signature\" if it succeeds. If you get \"Bad signature\" this means\nthe ISO has either been forged by an impostor pretending to be the Arch linux\nteam, or someone has tampered with the ISO stored on their servers or in\ntransit. If thats the case, you need to find an alternate source to download the\nISO.\u003c/p\u003e\n\u003ch3\u003ePreparing the Installation USB Drive\u003c/h3\u003e\n\u003cp\u003eThis installation method will first create a bootable USB stick, which is used\nto boot into a \"Live\" Arch Linux session. From there, we use the Live Arch Linux\nto install Arch onto your MacBook hard drive, then make that partition bootable.\u003c/p\u003e\n\u003cp\u003eIf you're currently running a GNU/Linux system, follow the instructions in\n\u003ca href=\"#part-a---preparing-the-installation-usb-drive-for-linux\"\u003ePart A\u003c/a\u003e. If you're\nrunning OS X,\n\u003ca href=\"#part-b---preparing-the-installation-usb-drive-for-osx\"\u003ejump one section ahead to Part B\u003c/a\u003e.\u003c/p\u003e\n\u003ch4\u003ePart A - Preparing the Installation USB Drive for Linux\u003c/h4\u003e\n\u003cp\u003eIf you're already on a GNU/Linux system, use these instructions to create USB\nbootable Arch Linux live system.\u003c/p\u003e\n\u003cp\u003eNow we’re ready to get that ISO onto a USB drive so we can boot the computer\nfrom it. Before inserting the thumb drive, run \u003ccode\u003elsblk\u003c/code\u003e and take note of the\ndrives listed. Insert the drive and run \u003ccode\u003elsblk\u003c/code\u003e again. Take note of the new\nletter in the \u003ccode\u003esdX\u003c/code\u003e list of drives.\u003c/p\u003e\n\u003cp\u003eReplace the \u003ccode\u003eX\u003c/code\u003e with the letter on your system. Be sure to unmount the new\ndrive.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eumount /dev/sdX\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNext, run the following command, it reads the ISO file you downloaded earlier\nand writes the contents directly to the USB drive, without the operating system\nbuffering the writes. Replace the \u003ccode\u003eX\u003c/code\u003e with the letter of the USB stick you took\nnote of earlier, and \u003ccode\u003eARCHLINUX\u003c/code\u003e with the name of the image file you downloaded.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003edd if=ARCHLINUX.iso of=/dev/sdX bs=4M\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAfter that’s run, the USB drive should be ready to boot from.\u003c/p\u003e\n\u003ch4\u003ePart B - Preparing the Installation USB Drive for OSX\u003c/h4\u003e\n\u003cp\u003eNow we’re ready to get that ISO onto a USB drive so we can boot the computer\nfrom it. Before inserting the thumb drive, run \u003ccode\u003ediskutil list\u003c/code\u003e and take note of\nthe drives listed. You should see output similar to this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/dev/disk0\n   #:                       TYPE NAME          SIZE       IDENTIFIER\n   0:      GUID_partition_scheme               500.1 GB   disk0\n   1:                        EFI               209.7 MB   disk0s1\n   2:          Apple_CoreStorage               399.5 GB   disk0s2\n   3:                 Apple_Boot Recovery HD   650.0 MB   disk0s3\n   5:                 Apple_Boot Boot OS X     134.2 MB   disk0s5\n/dev/disk1\n   #:                       TYPE NAME          SIZE       IDENTIFIER\n   0:                  Apple_HFS MacOSX        399.2 GB   disk1\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eInsert the drive and run \u003ccode\u003ediskutil list\u003c/code\u003e again. Take note of the new letter in\nthe \u003ccode\u003esdX\u003c/code\u003e list of drives.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/dev/disk0\n   #:                       TYPE NAME          SIZE       IDENTIFIER\n   0:      GUID_partition_scheme               500.1 GB   disk0\n   1:                        EFI               209.7 MB   disk0s1\n   2:          Apple_CoreStorage               399.5 GB   disk0s2\n   3:                 Apple_Boot Recovery HD   650.0 MB   disk0s3\n   5:                 Apple_Boot Boot OS X     134.2 MB   disk0s5\n/dev/disk1\n   #:                       TYPE NAME          SIZE       IDENTIFIER\n   0:                  Apple_HFS MacOSX        399.2 GB   disk1\n/dev/diskX\n   #:                       TYPE NAME          SIZE       IDENTIFIER\n   0:      GUID_partition_scheme               2.0 GB     disk2\n   1:       Microsoft Basic Data UNTITLED 1    2.0 GB     disk2s1\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNote \u003ccode\u003e/dev/diskX\u003c/code\u003e has appeared ('X' will be a number on your system), this new\ndisk is the USB thumb drive. \u003cstrong\u003eImportant\u003c/strong\u003e \u003cem\u003etake note of the number of this\ndrive\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003eWe're going to remove the existing partitions and erase all the data so its\nclean for our Arch Linux installer. This will delete all the data on the USB\ndrive. Make sure to substitute \u003ccode\u003e/dev/diskX\u003c/code\u003e for the drive number you noted\nabove.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003ediskutil partitionDisk /dev/diskX 1 \"Free Space\" \"unused\" \"100%\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow\u003csup\u003e\u003ca href=\"#user-content-fn-4\" id=\"user-content-fnref-4\" data-footnote-ref aria-describedby=\"footnote-label\"\u003e2\u003c/a\u003e\u003c/sup\u003e we can write the iso\nfile to the USB drive. \u003cstrong\u003eNote\u003c/strong\u003e We use \u003ccode\u003e/dev/rdisk*\u003c/code\u003e instead of \u003ccode\u003e/dev/disk\u003c/code\u003e\nbecause it provides Raw disk access without the typical buffering the operating\nsystemprovides. Substitute \u003ccode\u003eDESTINATION\u003c/code\u003e with the name of the \u003ccode\u003eiso\u003c/code\u003e file you\ndownloaded earlier, and substitute the \u003ccode\u003eX\u003c/code\u003e with the number of the drive.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003edd if=DESTINATION.iso of=/dev/rdiskX bs=1m\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe \u003ccode\u003edd\u003c/code\u003e command does not show any output before it has finished the copy\nprocess, so be patient and wait for it to complete, it can take around 1 - 5\nminutes. When the command does complete OS X will try to mount the drive and\nfail as it won't recognize the formatting. Click ignore.\u003c/p\u003e\n\u003ch2\u003eInstalling Arch\u003c/h2\u003e\n\u003cp\u003eWith the USB drive plugged in, restart the MacBook and press+hold down the left\n\u003ccode\u003eoption/alt\u003c/code\u003e key when you hear the startup chime. Hold the \u003ccode\u003eoption\u003c/code\u003e key down\nuntil the drive screen appears.\u003c/p\u003e\n\u003cp\u003eThe USB drive should be one of the options. Pick it along with the first option\nthe following boot screen lists. Now you should be at the Arch live install\nprompt and it'll look like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eArch Linux 3.17.6-1-ARCH (tty1)\n\narchiso login: root (automatic login)\nroot@archiso ~ #\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou are now running a \"Live\" session of Arch Linux from the USB stick.\u003c/p\u003e\n\u003cp\u003eIf you're on a HiDPI / \"Retina\" display MacBook, the prompt is really small.\nIncrease the font-size using \u003ccode\u003esetfont sun12x22\u003c/code\u003e.\u003c/p\u003e\n\u003ch3\u003eTest Internet\u003c/h3\u003e\n\u003cp\u003eYou'll need a working Internet connection to do the post-install. My MacBook Pro\n7,1 and 8,2 both have Ethernet ports, but some of you will have later models\nwithout one. You should get a USB-Ethernet adapter. Its much easier than\nfiddling with wireless drivers as it works out of the box. We'll setup the\nwireless drivers later in this article.\u003c/p\u003e\n\u003cp\u003eFirst, we need to get an IP address from your router:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003edhcpcd\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWith the adapter plugged in and an IP address, make sure internet is flowing by\npinging Google:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eping -c 3 www.google.com\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou should get a response that all three packets were sent and received.\u003c/p\u003e\n\u003ch3\u003eSet the System Clock\u003c/h3\u003e\n\u003cp\u003eThe system clock should be just fine. The general Arch wiki recommends ensuring\nthe system clock is accurate, and I’ve found it doesn’t seem to break anything.\nSo, I run it:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003etimedatectl set-ntp true\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003ePartition the Hard Drive\u003c/h3\u003e\n\u003cp\u003eA partition is basically a box on the hard drive to put files into. OS X has a\nbox for its files, and we're going to create box(es) for GNU/Linux. Partitioning\nthe hard drive takes existing data on the drive and moves or erases it to make\nspace available for other file systems.\u003c/p\u003e\n\u003cp\u003eThis part is the trickiest because it can erase data on the disk, so take care.\u003c/p\u003e\n\u003cp\u003eApple uses the GUID Partition Table (GPT), and we're going to keep that\npartition table.\u003c/p\u003e\n\u003cp\u003eIn order to proceed you'll need to know the drive mapping scheme, we'll use\n\u003ccode\u003efdisk\u003c/code\u003e to check the scheme:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003efdisk -l\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis lists the existing partitions. If you created two partitions when preparing\nthe MacBook, you should see a partition with a Type of \u003ccode\u003eApple HFS/HFS+\u003c/code\u003e with a\nsize that matches the size you set aside for Arch. In my case this was\n\u003ccode\u003e/dev/sda5\u003c/code\u003e. All the partitioning commands below will use \u003ccode\u003e/dev/sda5\u003c/code\u003e, \u003cstrong\u003eyou\nshould substitute the designation for your drive\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eLets use \u003ccode\u003ecgdisk\u003c/code\u003e to view the partition table on the attached devices: Replace\nthe \u003ccode\u003eY\u003c/code\u003e with the drive you'll be using to install Arch Linux.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003ecgdisk /dev/sdY\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAt the end of the partition table should be the free space you set aside for\ninstalling Arch. With that space, we're going to create a new partition. You\njust need to make one partition; we’re going to break it into sub-partitions\nlater; after encryption is setup.\u003c/p\u003e\n\u003cp\u003eI added 128MB between the last partition and my new partition\n\u003ca href=\"https://developer.apple.com/library/mac/technotes/tn2166/_index.html\"\u003ebecause of this explanation by Apple\u003c/a\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eNote: We leave free space after each partition to make it easier for future\nsystem software to manipulate the partition map in ways that we can’t\nanticipate currently.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eBegin by deleting the \u003ccode\u003eHFS\u003c/code\u003e partition created when you set aside space in OS X\nfor Arch Linux.\u003c/p\u003e\n\u003cp\u003eIn order to leave additional space, just type \u003ccode\u003e+128M\u003c/code\u003e when you create the new\npartition, and it'll set the starting sector at a point 128M away from the\nending sector of the partition before it.\u003c/p\u003e\n\u003cp\u003eYou’ll want to use Linux LVM (\u003ccode\u003e8e00\u003c/code\u003e) as the partition type id. The final\npartition table will look something like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ePart. #     Size        Partition Type            Partition Name\n----------------------------------------------------------------\n3.0 KiB      free space\n1        200.0 MiB      EFI System                EFI System Partition\n2         74.5 GiB      Apple HFS/HFS+            Macintosh HD\n128.0 MiB      free space\n3        391.1 GiB      Linux LVM                 ArchLinux\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen use the utility to select Write and then confirm that you want to overwrite\nthe disk. Once the display returns you can Quit.\u003c/p\u003e\n\u003cp\u003eRunning \u003ccode\u003efdisk -l\u003c/code\u003e again should show your new partition scheme. If it doesn't\nlook like you want or expected, repeat the \u003ccode\u003ecgdisk\u003c/code\u003e process to fix things until\nyou're satisfied.\u003c/p\u003e\n\u003ch3\u003eConfiguring Drive Encryption and LVM\u003c/h3\u003e\n\u003cp\u003eYou’ll want to make note of the partition number you just created. For me it’s\npartition \u003ccode\u003e5\u003c/code\u003e, and the drive is \u003ccode\u003esda\u003c/code\u003e, so my Arch Linux partition can be found\nat \u003ccode\u003e/dev/sda5\u003c/code\u003e. I'll be using that as an example going forward, \u003cstrong\u003ebut you should\nsubstitute your own drive path\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eWe’re going to encrypt \u003ccode\u003e/dev/sda5\u003c/code\u003e using DM-Crypt and then the LVM partitions\nare going to be created over that LUKS encryption layer. This system is called\n\"LVM on LUKS.\" Both LUKS encryption and LVM support are provided by the\nGNU/Linux kernel.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eNote\u003c/strong\u003e This will just encrypt the system \u003ccode\u003e/\u003c/code\u003e and \u003ccode\u003e/home\u003c/code\u003e directories. The\n\u003ccode\u003e/boot\u003c/code\u003e directory will not be encrypted because we’re going to keep the existing\n\u003ccode\u003e/boot\u003c/code\u003e partition: That’s \u003ccode\u003e/dev/sda1\u003c/code\u003e in my partition table above.\u003c/p\u003e\n\u003cp\u003eIf you want to use custom ciphers, there are some great notes\n\u003ca href=\"https://github.com/NoviceLive/unish/blob/master/doc/arch-install.sh#L101\"\u003eavailable on GitHub\u003c/a\u003e.\nYou can also use the following command for speed benchmarking to help determine\nwhich ciphers and key-sizes are fast enough for your particular use case:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003ecryptsetup benchmark\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTime to pick the encryption flavors! The default values for the cipher and key\nsizes were a bit too light for my tastes (in light of the NSA spying scandal).\nI've increased these numbers above the defaults, I've chosen to balance my\nprincipals for privacy and security with practical usability and speed. Feel\nfree to\n\u003ca href=\"https://wiki.archlinux.org/index.php/Dm-crypt/Device_encryption#Encryption_options_for_LUKS_mode\"\u003eread more on these settings\u003c/a\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003ecryptsetup --cipher aes-xts-plain64 \\\n  --key-size 512 \\\n  --hash sha256 \\\n  --iter-time 3000 \\\n  --use-random \\\n  --verify-passphrase \\\n  luksFormat /dev/sda5\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eEnter in a good passphrase (twice), and we should be good to go.\u003c/p\u003e\n\u003cp\u003eNow with the encryption setup, we’re going to create the necessary volumes and\nfilesystems within the LVM.\u003c/p\u003e\n\u003cp\u003eFirst, let’s open up our encrypted partition:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003ecryptsetup luksOpen /dev/sda5 lvm\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis is going to map our encrypted device (\u003ccode\u003e/dev/sda5\u003c/code\u003e in my case) to\n\u003ccode\u003e/dev/mapper/lvm\u003c/code\u003e. Now we’re going to create the physical and logical volumes\nfor the \u003ccode\u003e/\u003c/code\u003e and \u003ccode\u003e/home\u003c/code\u003e directories. I gave the \u003ccode\u003e/\u003c/code\u003e directory 40GB (hopefully\nenough for all my programs. As of writing this, and with a full install, I’m\nusing 10GB on my \u003ccode\u003e/\u003c/code\u003e directory. So, I think I’m good.\u003c/p\u003e\n\u003cp\u003eCreate the physical volume:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003epvcreate /dev/mapper/lvm\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow create the volume with the name \u003ccode\u003evgcrypt\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003evgcreate vgcrypt /dev/mapper/lvm\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe're ready to create the logical volumes now, \u003ccode\u003e40GB\u003c/code\u003e for root and the rest for\nusers’ home, change \u003ccode\u003e40GB\u003c/code\u003e accordingly:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003elvcreate --size 40G --name root vgcrypt\nlvcreate --extents +100%FREE --name home vgcrypt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe now have our two volumes \u003ccode\u003evgcrypt-root\u003c/code\u003e and \u003ccode\u003evgcrypt-home\u003c/code\u003e. They need to be\nformatted to a particular filesystem. I’ve been happy with the \u003ccode\u003eext4\u003c/code\u003e\nfilesystem.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003emkfs.ext4 /dev/mapper/vgcrypt-root\nmkfs.ext4 /dev/mapper/vgcrypt-home\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe can now mount these new partitions. Make sure to mount the root partition\nfirst so we can create the \u003ccode\u003e/home\u003c/code\u003e directory inside of it for the home\npartition:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003emount /dev/mapper/vgcrypt-root /mnt\nmkdir -p /mnt/home\nmount /dev/mapper/vgcrypt-home /mnt/home\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eLets also mount our boot partition, while we're here. This is required so our\nbootable initramfs can be written to the boot drive:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003emkdir -p /mnt/boot\nmount /dev/sda1 /mnt/boot\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf you're interested in swap partition schemes,\n\u003ca href=\"https://github.com/NoviceLive/unish/blob/master/doc/arch-install.sh#L127\"\u003echeck this script out\u003c/a\u003e\n− although I'm fine without swap partitions (Its faster with enough RAM).\u003c/p\u003e\n\u003cp\u003eAnd with that, Arch is now ready to be installed on the disk.\u003c/p\u003e\n\u003ch3\u003eSelect a Mirror\u003c/h3\u003e\n\u003cp\u003eThis step can optionally be skipped, but I prefer to choose a US server just in\ncase it may be faster. Open up the mirrorlist:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003evi /etc/pacman.d/mirrorlist\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDelete or comment out all the servers except one or two near you that seem good.\u003c/p\u003e\n\u003ch3\u003eInstall the Base System\u003c/h3\u003e\n\u003cp\u003eActually installing Arch Linux onto the drive is the easiest part:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003epacstrap -i /mnt base base-devel terminus-font\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe \u003ccode\u003e-i\u003c/code\u003e flag asks for confirmation before installing packages. I like using it\njust so I can see what’s being installed. (After all that's part of the reason\nfor using GNU/Linux, right? To know what’s being installed on your system.)\u003c/p\u003e\n\u003cp\u003eThis installation includes \u003ccode\u003eterminus-font\u003c/code\u003e, which we'll configure to be the\ndefault console font later on.\u003c/p\u003e\n\u003ch3\u003eGenerate the fstab\u003c/h3\u003e\n\u003cp\u003eIf all went according to plan, Arch has been written to the hard drive and is\nnow installed. Before rebooting into our installation, though, we need to tell\nthe system where to find the filesystems we created earlier for root and home\ndirectories.\u003c/p\u003e\n\u003cp\u003eWhile it’s normally a good idea to use UUIDs to find disks, we’re going to use\nlabels. This is because our encryption setup generates random IDs for the disks\nwhen they’re decrypted. Let’s create the \u003ccode\u003efstab\u003c/code\u003e file:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003egenfstab -L -p /mnt \u003e\u003e /mnt/etc/fstab\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe \u003ccode\u003e-L\u003c/code\u003e flag will generate the fstab file with labels instead of UUIDs. The\n\u003ccode\u003e-p\u003c/code\u003e flag prevents pseudo-filesystems from being added.\u003c/p\u003e\n\u003cp\u003eAlways check the generated fstab:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003ecat /mnt/etc/fstab\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt should look something like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e#\n# /etc/fstab: static file system information\n#\n# \u0026#x3C;file system\u003e    \u0026#x3C;dir\u003e\u0026#x3C;type\u003e\u0026#x3C;options\u003e             \u0026#x3C;dump\u003e\u0026#x3C;pass\u003e\n# /dev/mapper/vgcrypt-root\n/dev/mapper/vgcrypt-root    /           ext4   discard,rw,relatime,data=ordered    0 1\n\n# /dev/mapper/vgcrypt-home\n/dev/mapper/vgcrypt-home    /home       ext4   discard,rw,relatime,data=ordered    0 2\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eNote\u003c/strong\u003e If your hard drive is a solid-state drive (SSD) and the \u003ccode\u003ediscard\u003c/code\u003e\noption isn’t there, edit the fstab file and add it. It's used for optimizing for\nthe speed of SSDs.\u003c/p\u003e\n\u003ch3\u003eConfigure The System\u003c/h3\u003e\n\u003cp\u003eWe’re now ready to configure our new system. Let’s change root into it:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003earch-chroot /mnt /bin/bash\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSet our system locale. I'm in the US, so I'll only uncomment that locale from\n\u003ccode\u003e/etc/locale.gen\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e...\nen_US.UTF-8 UTF-8\nen_US ISO-8859-1\n...\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow generate the locales:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003elocale-gen\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eMake English UTF-8 the default:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eecho LANG=en_US.UTF-8 \u003e /etc/locale.conf\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe default font in the virtual console is not very readable, so lets use one\nthat is far more readable. We're going to use the typeface \"Terminus\" in size 18\nthat we installed with the base system earlier. \u003ccode\u003eter-118n\u003c/code\u003e basically means\n\"Terminus latin-1 size 18 Normal\". There are other sizes available: 12, 14, 16,\n20, 22, 24, 28, 32 as well as support for multiple non-English code pages.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eecho FONT=ter-118n \u003e /etc/vconsole.conf\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSet the timezone accordingly. (I live on the east coast):\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eln -sf /usr/share/zoneinfo/America/New_York /etc/localtime\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd set the time to the standard UTC:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003ehwclock --systohc --utc\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBecause we've encrypted our root disk, we need to make sure the kernel loads the\nproper modules to decrypt it on startup. Otherwise we won’t be able to boot from\nthe unencrypted drive. We're also going to tell the boot-sequence to load our\ncustom font and keyboard module so we can type our passwords during boot. Edit\n\u003ccode\u003e/etc/mkinitcpio.conf\u003c/code\u003e and add the hooks \u003ccode\u003econsolefont keyboard encrypt lvm2\u003c/code\u003e\n\u003cstrong\u003eBEFORE\u003c/strong\u003e \u003ccode\u003efilesystems\u003c/code\u003e so the HOOKS line looks like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eHOOKS=\"base udev autodetect modconf block consolefont keyboard usbinput encrypt lvm2 filesystems fsck\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow we need to regenerate the initramfs image:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003emkinitcpio -p linux\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSo that Internet will work on reboot, we need to enable the \u003ccode\u003edhcpcd\u003c/code\u003e service.\nWe’re going to keep using the ethernet-USB adapter for right now. We'll get\nwireless setup later. Get the name of the ethernet interface:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eip link\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt should be \u003ccode\u003eenp\u003c/code\u003e-something. With that, enable the service, make sure you\nreplace INTERFACE with your interfaces name.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003esystemctl enable dhcpcd@INTERFACE.service\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFinally, let’s configure the machine’s hostname. You can change \u003ccode\u003emacbook\u003c/code\u003e to\nwhatever you'd like:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eecho macbook \u003e /etc/hostname\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAdd this hostname to the list of hosts. Edit \u003ccode\u003e/etc/hosts\u003c/code\u003e and edit so it looks\nsomething like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e#\n# /etc/hosts: static lookup table for host names\n#\n\n#\u0026#x3C;ip-address\u003e   \u0026#x3C;hostname.domain.org\u003e   \u0026#x3C;hostname\u003e\n127.0.0.1   localhost.localdomain   localhost   macbook\n::1     localhost.localdomain   localhost   macbook\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSet a root password:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003epasswd\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCreate a non-root user for yourself and set the user’s password, replace USER\nwith the username of your choosing:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003euseradd --create-home --groups wheel --shell /bin/bash USER\npasswd USER\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis will create the user, add it to the group wheel (traditional group of users\nwho can run \u003ccode\u003esudo\u003c/code\u003e commands), create a home directory under \u003ccode\u003e/home/USER/\u003c/code\u003e and\nmake his default shell \u003ccode\u003ebash\u003c/code\u003e then set a default password for the user.\u003c/p\u003e\n\u003cp\u003eDon't switch to the new user yet, because we'e added USER to the group \u003ccode\u003ewheel\u003c/code\u003e,\nlets grant the wheel group \u003ccode\u003esudo\u003c/code\u003e privileges. Run:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003evisudo\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd uncomment the following line so it looks like so:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e%wheel ALL=(ALL) ALL\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eBoot Loader\u003c/h3\u003e\n\u003cp\u003eNow we need to let the boot loader know where to find our new Arch Linux\ninstallation. \u003ccode\u003esystemd\u003c/code\u003e (was recently renamed, was Gummiboot) is a nice, simple\nboot loader.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# pacman -S systemd              # May be systemd-boot, included in core?\nmkdir -p /boot/loader/entries\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSetup the loader to default to arch and set the number of seconds to timeout in\nthe file \u003ccode\u003e/boot/loader/loader.conf\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003edefault arch\ntimeout 3\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eMake sure the correct boot partition (\u003ccode\u003e/dev/sda1\u003c/code\u003e in my case) is mounted on\n\u003ccode\u003e/boot\u003c/code\u003e by running:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003efindmnt /boot\n-------------------------\nTARGET SOURCE    FSTYPE OPTIONS\n/boot  /dev/sda1 vfat   rw,relatime,fmask=0022,dmask=0022,codepage=437,iocharset=iso8859-1,shortname=mixed,err\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow we’re going to create an entry called \u003ccode\u003e/boot/loader/entries/arch.conf\u003c/code\u003e that\nlooks like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# /boot/loader/entries/arch.conf\ntitle   Arch Linux\nlinux   /vmlinuz-linux\ninitrd  /initramfs-linux.img\noptions cryptdevice=/dev/sdaX:vgcrypt:allow-discards root=/dev/mapper/vgcrypt-root rw\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eNote\u003c/strong\u003e:\u003csup\u003e\u003ca href=\"#user-content-fn-7\" id=\"user-content-fnref-7\" data-footnote-ref aria-describedby=\"footnote-label\"\u003e3\u003c/a\u003e\u003c/sup\u003e On the options\nline, make sure you replace \u003ccode\u003e/dev/sdaX\u003c/code\u003e with the path to the encrypted linux\npartition we previously created on your device (It was \u003ccode\u003e/dev/sda5\u003c/code\u003e in this\nguide). Additionally, if your drive is \u003cem\u003enot\u003c/em\u003e a SSD, make sure to remove\n\u003ccode\u003e:allow-discards\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eNote\u003c/strong\u003e:\u003csup\u003e\u003ca href=\"#user-content-fn-9\" id=\"user-content-fnref-9\" data-footnote-ref aria-describedby=\"footnote-label\"\u003e4\u003c/a\u003e\u003c/sup\u003e Its been reported\nby some users that when booting to USB, the USB drive is assigned device id\n\u003ccode\u003e/dev/sda\u003c/code\u003e and the hard drive to \u003ccode\u003e/dev/sdb\u003c/code\u003e. When rebooting without USB drive\n(boot to new encrypted linux drive partition), the hard drive is reassigned to\ndevice id \u003ccode\u003e/dev/sda\u003c/code\u003e which may invalidate the above \u003ccode\u003earch.conf\u003c/code\u003e boot loader\nentry. In this case, the encrypted linux partition will not boot because the\nboot loader config \u003ccode\u003earch.conf\u003c/code\u003e is configured to boot from \u003ccode\u003e/dev/sdb\u003c/code\u003e. In this\ncase you can reboot to USB again, and edit the options line in \u003ccode\u003earch.conf\u003c/code\u003e to\nread \u003ccode\u003e/dev/sdaX\u003c/code\u003e. Replace X with your partition id.\u003c/p\u003e\n\u003cp\u003eCheck the boot tree with \u003ccode\u003etree /boot/\u003c/code\u003e (If \u003ccode\u003etree\u003c/code\u003e isn’t installed, install it\nwith \u003ccode\u003epacman -S tree\u003c/code\u003e). It should look something like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/boot/\n├── EFI\n│   ├── APPLE\n│   │   └── EXTENSIONS\n│   │       └── Firmware.scap\n│   ├── Boot\n│   │   └── BOOTX64.EFI\n│   └── gummiboot\n│       └── gummibootx64.efi\n├── initramfs-linux-fallback.img\n├── initramfs-linux.img\n├── loader\n│   ├── entries\n│   │   └── arch.conf\n│   └── loader.conf\n└── vmlinuz-linux\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eNote\u003c/strong\u003e: At this point, you may want to enable suspend-to-disk (No power\nconsumption aka \"Hibernate\" mode). I've chosen not to enable this functionality,\nbut if you're interested, you can\n\u003ca href=\"http://loicpefferkorn.net/2015/01/arch-linux-on-macbook-pro-retina-2014-with-dm-crypt-lvm-and-suspend-to-disk/#suspend-to-disk-uswsusp:385892e3ac2613dca78d22bd09dbae7d\"\u003eread about it here\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eNow we can have the bootloader write the initramfs onto the boot partition using\n\u003ccode\u003ebootctl\u003c/code\u003e, part of the systemd-boot package.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003ebootctl install\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eReboot into New Installation\u003c/h3\u003e\n\u003cp\u003eLet’s leave the chroot environment we used for the install:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eexit\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou can umount and close the encrypted volume:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eumount -R /mnt\ncryptsetup close vgcrypt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt’s not a bad idea to just double check the encryption to make sure it opens\nand mounts properly:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003ecryptsetup open /dev/sda5 vgcrypt\nmount /dev/mapper/vgcrypt /mnt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf all goes accordingly, you can unmount and close the encryption again. And\nfinally…\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003ereboot\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOn reboot you should be greeted with the boot menu. After selecting Arch (or\nwaiting for it to timeout), you should be prompted for your password to decrypt\nthe drive, and then it should boot into the console.\u003c/p\u003e\n\u003ch2\u003eConfiguring Arch\u003c/h2\u003e\n\u003cp\u003eYou should now be running Arch Linux! Lets customize it and make it more useful.\u003c/p\u003e\n\u003ch3\u003eInstall an Arch User Repository Package Manager\u003c/h3\u003e\n\u003cp\u003eNow we're about to dive deep into customizing Arch Linux installation with the\nutilities and application we'll be using on a day-to-day basis. To facilitate\ninstalling packages from the wider Arch User Repository (AUR), we'll install a\nutility named \u003ccode\u003eyaourt\u003c/code\u003e. You can (of course) maintain AUR package installations\nmanually, but I like a helper to help me manage them. yaourt is like the\nHomebrew of Arch Linux. I use\n\u003ca href=\"https://wiki.archlinux.org/index.php/Yaourt\"\u003eyaourt\u003c/a\u003e because it’s easy to\ninstall, takes the same optional flags as \u003ccode\u003epacman\u003c/code\u003e, and works well.\u003c/p\u003e\n\u003cp\u003eYou need to use the \"official\" and manual way of installing AUR packages to get\nyaourt installed. It also requires \u003ccode\u003epackage-query\u003c/code\u003e from the AUR, so we’re going\nto install that first.\u003c/p\u003e\n\u003cp\u003eNow we’re going to download the \u003ccode\u003epackage-query\u003c/code\u003e AUR package, unarchive it, and\nuse pacman to build and install the package. This allows us to manage the\npackage as if it was installed with pacman, although we're manually installing\nit.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e$ cd ~\n$ curl -L -O https://aur.archlinux.org/cgit/aur.git/snapshot/package-query.tar.gz\n$ tar -xvzf package-query.tar.gz\n$ cd package-query\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWithin the packages' folder, we’re going to run the following to build it:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e$ makepkg -s\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis will run as your regular user only asking you for your root password if\nnecessary. With the package made, we can install it via pacman:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# pacman -U package-query-1.6.2-1-x86_64.pkg.tar.xz\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow we’ll do the same for yaourt:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e$ cd ~\n$ curl -L -O https://aur.archlinux.org/cgit/aur.git/snapshot/yaourt.tar.gz\n$ tar -xvzf yaourt.tar.gz\n$ cd yaourt\n$ makepkg -s\n# pacman -U yaourt-1.6-1-any.pkg.tar.xz\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFrom now on you can use \u003ccode\u003epacman\u003c/code\u003e and \u003ccode\u003eyaourt\u003c/code\u003e interchangeably… for the most\npart. \u003ccode\u003eyaourt\u003c/code\u003e will install Arch repository packages and AUR packages. \u003ccode\u003epacman\u003c/code\u003e,\nthough, will continue to only install Arch repository packages.\u003c/p\u003e\n\u003ch3\u003eConfigure Sound\u003c/h3\u003e\n\u003cp\u003eALSA works out of the box with Macs so install it via:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# pacman -S alsa-utils\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen use:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003ealsamixer\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eto control the speakers. Make sure to disable channels for speakers you don't\nhave. Test your speakers with:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003espeaker-test -c 2\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ewhere 2 is the number of speakers.\u003c/p\u003e\n\u003ch3\u003eInstall X and Video Drivers\u003c/h3\u003e\n\u003cp\u003eAs this is going to be a graphical interface, we need are graphics card up and\nrunning with the proper drivers. Luckily this machine uses Intel graphics, and\nIntel is pretty good about providing Linux (and sometimes open-source) drivers.\u003c/p\u003e\n\u003cp\u003eFor Macbookpro 7,1 (Mid-2010 or 8,2 (Early-2011):\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# pacman -S xf86-video-intel mesa-libgl libva-intel-driver libva\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFor Macbookpro 11,3\n(Late-2013)\u003csup\u003e\u003ca href=\"#user-content-fn-8\" id=\"user-content-fnref-8\" data-footnote-ref aria-describedby=\"footnote-label\"\u003e5\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# pacman -S nvidia mesa-libgl libva-intel-driver libva\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe \u003ccode\u003e-S\u003c/code\u003e flag tells pacman to install the subsequent packages listed. (Again,\nyou can use yaourt if you’d like.) This will install the Intel video driver, the\nMesa OpenGL graphics library, and video acceleration API for Intel graphics\nchipsets. It'll likely ask you to install additional dependencies. Get all the\ndependencies!\u003c/p\u003e\n\u003cp\u003eWith the necessary drivers installed, we can get Xorg (or the X Window System)\ninstalled.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# pacman -S xorg-server xorg-server-utils xorg-xinit xterm\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI like to install the Xorg utilities, too, because there are at least a couple\nI'll use later (either in this guide or another) that are helpful in improving\nHiDPI support for the MacBook’s HiDPI Retina display.\u003c/p\u003e\n\u003ch3\u003eSome GUI Applications\u003c/h3\u003e\n\u003cp\u003eNext we'll install a browser. This will install some typeface dependencies and\nfont- rendering libraries that we'll be tweaking later.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# pacman -S firefox\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eImproved Typography\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eUpdate\u003csup\u003e\u003ca href=\"#user-content-fn-10\" id=\"user-content-fnref-10\" data-footnote-ref aria-describedby=\"footnote-label\"\u003e6\u003c/a\u003e\u003c/sup\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eIt appears\n\u003ca href=\"https://github.com/bohoomil/fontconfig-ultimate/issues/191\"\u003ethe package maintainer for Infinality has gone dark\u003c/a\u003e\u003c/strong\u003e.\nSkip this section and \u003ca href=\"#window-manager-awesome\"\u003econtinue to the next\u003c/a\u003e until\nthere is a solution for better typography on the linux desktop.\u003c/p\u003e\n\u003cp\u003eIf you use the web and appreciate typography, you'll want to install a set of\ndecent fonts.\u003c/p\u003e\n\u003cp\u003eInfinality is a package group that has been meticulously crafted from the\nground-up to provide beautifully rendered typography to the Linux platform. The\npackage maintainer spent a ton of time tearing down the existing font stack, and\ncarefully rebuilding it to provide fast-rendering fonts that more faithfully\npresent the typography than either Windows, OS X or Ubuntu systems. It also\nprovides a set of preset-configurations that allow the user to switch to a\nWindows-like or OS X-like configuration. I highly recommend\n\u003ca href=\"http://bohoomil.com/doc/\"\u003ereading the documentation\u003c/a\u003e if you'd like to know more\nabout typography rendering on GNU/Linux.\u003c/p\u003e\n\u003cp\u003eFirst add the following package repositories to \u003ccode\u003e/etc/pacman.conf\u003c/code\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e[infinality-bundle]\nServer = http://bohoomil.com/repo/$arch\n[infinality-bundle-fonts]\nServer = http://bohoomil.com/repo/fonts\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNext we'll add the\n\u003ca href=\"https://bbs.archlinux.org/viewtopic.php?id=162098\"\u003epackage maintainers PGP key\u003c/a\u003e\nto the package database, update the package database and install the packages.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# pacman-key -r 962DDE58\n# pacman-key --lsign-key 962DDE58\n# pacman -Syyu\n# pacman -S infinality-bundle\n# pacman -S infinality-bundle-fonts\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eMake sure to select the option \u003ccode\u003efontconfig-infinality-ultimate\u003c/code\u003e as that\nconfiguration\n\u003ca href=\"http://bohoomil.com/doc/01-overview/\"\u003eis the most clean, efficient and looks the best out of the box\u003c/a\u003e.\nThe installation may ask to use the Infinality packages in place of the\ndependencies installed by Firefox. Choose the Infinality packages.\u003c/p\u003e\n\u003cp\u003eTo enable selection of predefined font substitution styles and antialiasing\nsettings, apart from the rendering settings of the engine itself. After doing\nso, you can select the font style (win7, winxp, osx, linux, ...) with:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# fc-presets set\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eWindow Manager Awesome\u003c/h3\u003e\n\u003cp\u003eAwesome is a tiling window manager for the user that prefers keyboard commands\nto mouse or touchpad, and treats window chrome as needless ornamentation. Your\napplication content is king, and efficiency is the goal. Its quick and light.\nLets install the window manager (WM), awesome.\u003c/p\u003e\n\u003cp\u003eTo install:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# pacman -S awesome\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAdded this\u003csup\u003e\u003ca href=\"#user-content-fn-5\" id=\"user-content-fnref-5\" data-footnote-ref aria-describedby=\"footnote-label\"\u003e7\u003c/a\u003e\u003c/sup\u003e to run \u003ccode\u003eawesome\u003c/code\u003e\nwhen x starts:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eecho exec awesome \u003e .xinitrc\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eTouchpad Support\u003c/h3\u003e\n\u003cp\u003eYou’ll probably want to use your MacBook’s touchpad when you have a GUI. The\nsimplest driver is the synaptics driver:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# pacman -S xf86-input-synaptics\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe following config at /usr/share/X11/xorg.conf.d/70-synaptics.conf works well\nfor me, it uses the same \"Natural Motion\" that OS X does. Copy that file to the\nfollowing location \u003ccode\u003e/etc/X11/xorg.conf.d/70-synaptics.conf\u003c/code\u003e and add the options\nbetween the \u003ccode\u003eSTART\u003c/code\u003e and \u003ccode\u003eEND\u003c/code\u003e comments.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eSection \"InputClass\"\n    MatchIsTouchpad \"on\"\n    Identifier      \"touchpad catchall\"\n    Driver          \"synaptics\"\n\n    # START: Add these options\n    # 1 = left, 2 = right, 3 = middle\n    Option          \"TapButton1\" \"1\"\n    Option          \"TapButton2\" \"3\"\n    Option          \"TapButton3\" \"2\"\n    # Palm detection\n    Option          \"PalmDetect\" \"1\"\n    # Horizontal scrolling\n    Option \"HorizTwoFingerScroll\" \"1\"\n    Option \"VertTwoFingerScroll\" \"on\"\n    # Natural Scrolling (and speed)\n    Option \"VertScrollDelta\" \"-450\"\n    Option \"HorizScrollDelta\" \"-450\"\n    # END\nEndSection\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eConfiguring Wireless\u003c/h3\u003e\n\u003cp\u003eBefore rebooting into our lovely new GUI, let's get wireless setup to work when\nwe reboot.\u003c/p\u003e\n\u003cp\u003eThis particular machine has the Broadcom BCM4360 wireless chipset. Broadcom has\nbeen pretty mixed in the FLOSS support it seems. The BCM4360 is not supported by\nthe kernel itself, so we’ll need to use Broadcom’s non-free, non-open driver:\n\u003ccode\u003ebroadcom-wl\u003c/code\u003e. I actually don’t think this even officially supports the BCM4360\nchipset, but it works well enough. We’ll need to install the AUR package:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e$ yaourt -S broadcom-wl dialog wpa_supplicant\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd activate the kernel module:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# modprobe wl\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eNote\u003c/strong\u003e: If you update to a newer kernel in the future, you may need to\nuninstall and reinstall the \u003ccode\u003ebroadcom-wl\u003c/code\u003e package so it updates with the new\nlinux-header.\u003c/p\u003e\n\u003cp\u003eWe need to stop the dhcpcd service we were using for the ethernet and start the\n\u003ccode\u003ewifi-menu\u003c/code\u003e\u003csup\u003e\u003ca href=\"#user-content-fn-1\" id=\"user-content-fnref-1-2\" data-footnote-ref aria-describedby=\"footnote-label\"\u003e1\u003c/a\u003e\u003c/sup\u003e utility.\nKeeping both running can cause conflicts.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# systemctl disable dhcpcd.service\n# wifi-menu\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis will create and enable a systemd service that will start when the computer\nboots. Changes to the profile file will not propagate to the service file\nautomatically. After such changes, it is necessary to reenable the profile:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# netctl reenable PROFILE\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAfter enabling a profile, it will be started at next boot.\u003c/p\u003e\n\u003cp\u003eFinally, if you find your wireless is dropping connections, you may find turning\noff Wi-Fi power management. Simply create this as an executable ( chmod +x\n\u003ccode\u003e/etc/pm/wireless\u003c/code\u003e and add the following contents:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e#!/bin/sh\niwconfig wlp2s0 power off\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eDone!\u003c/h3\u003e\n\u003cp\u003eNow when you reboot, you should be all set to go start customizing to your\nheart’s content, adding applications as you’d like, and playing around with your\nnew Arch Linux box with Awesome.s\u003c/p\u003e\n\u003ch2\u003eFine Tuning\u003c/h2\u003e\n\u003cp\u003ePower settings took quite a bit of tweaking. Without these setting, the laptop\nran very hot, and drained battery life very fast. I would recommend following\nthese steps to improve battery life. There still may be room for improvement,\nthough.\u003c/p\u003e\n\u003cp\u003eOne more thing: If you search \"MacBook Pro and Arch Linux\" you’ll probably read\nsome things about disabling ACPI interrupts that were causing overheating and\nhigh CPU usage. If you have updated to the latest version of OS X 10.10\n\"Yosemite\" then you should be OK to skip.\u003c/p\u003e\n\u003ch3\u003eDisplay Color Profile\u003c/h3\u003e\n\u003cp\u003eI noticed that colors seemed washed-out in Arch Linux, so this task will attempt\nto color-correct the display. Luckily a utility \u003ccode\u003excalib\u003c/code\u003e exists that can load\ncolor profiles from OS X as X options. This should give you true color-parity\nbetween operating systems.\u003c/p\u003e\n\u003cp\u003eFirst, boot into OS X and copy the color profiles located in\n\u003ccode\u003e/Library/ColorSync/Profiles/Displays\u003c/code\u003e to somewhere so you can boot into\nGNU/Linux and copy them into your home directory. I created a directory named\n\u003ccode\u003e~/.colorprofiles\u003c/code\u003e for these files.\u003c/p\u003e\n\u003cp\u003eSecond, install the \u003ccode\u003excalib\u003c/code\u003e package from the Arch AUR.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eyaourt -S xcalib\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFinally you can activate it by running:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003excalib ~/.colorprofiles/FILENAME.icc\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWhere \u003ccode\u003eFILENAME\u003c/code\u003e is the path to your color profile file.\u003c/p\u003e\n\u003cp\u003eTo load this color profile when X starts, I also added this command to the\n\u003ccode\u003e.xinitrc\u003c/code\u003e file in my home directory. Just make sure you replace \u003ccode\u003eFILENAME\u003c/code\u003e with\nthe name of your color-profile \u003ccode\u003e.icc\u003c/code\u003e file exported from OS X.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eif [ `type -P xcalib` ]; then\n  # Use the color profile\n  xcalib ~/.colorprofiles/FILENAME.icc\nfi;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eDisplay Color Correction\u003c/h3\u003e\n\u003cp\u003eIf you spend as many hours looking at the display as I do, you'll quickly\nappreciate a display that adapts its colors to the time of day.\n\u003ca href=\"https://justgetflux.com\"\u003eF.lux\u003c/a\u003e adjusts monitor color temperature adaptively to\nease eye strain.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eyaourt -S xfluxd\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen edit \u003ccode\u003e/etc/xfluxd.conf\u003c/code\u003e to set your rough lat/long coordinates (in decimal\nformat) in order to correctly shift the color correction with the sunrise and\nsunset.\u003c/p\u003e\n\u003cp\u003eFinally, enable and start the \u003ccode\u003exfluxd\u003c/code\u003e service. \u003cstrong\u003eNote\u003c/strong\u003e you should run this as\nyour normal user, not as root.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003esystemctl enable --user xfluxd\nsystemctl start --user xfluxd\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003ePower Management\u003c/h3\u003e\n\u003cp\u003eThe power management from Arch out of the box is not very good. There are a few\ngood tools out there, but \u003ccode\u003ePowerTOP\u003c/code\u003e is nice because of its benchmarking\nutilities\u003csup\u003e\u003ca href=\"#user-content-fn-2\" id=\"user-content-fnref-2\" data-footnote-ref aria-describedby=\"footnote-label\"\u003e8\u003c/a\u003e\u003c/sup\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ePowerTOP is a tool provided by Intel to enable various powersaving modes in\nuserspace, kernel and hardware. It is possible to monitor processes and show\nwhich of them are utilizing the CPU and wake it from its Idle-States, allowing\nyou to identify applications with particular high power demands.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eyaourt -S powertop\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou may want to put your laptop on battery power and calibrate powertop:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# powertop --calibrate\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThat’ll cause the screen to blackout from time to time. Just let it run. It\ntakes a few minutes then your screen will come back on.\u003c/p\u003e\n\u003cp\u003eYou can create a systemd service that will launch powertop's autotune settings\non startup.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# /etc/systemd/system/powertop.service\n\n[Unit]\nDescription=Powertop tunings\n\n[Service]\nType=oneshot\nExecStart=/usr/bin/powertop --auto-tune\n\n[Install]\nWantedBy=multi-user.target\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd enable it to automatically start at boot time, then start it for your\ncurrent boot session.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# systemctl enable powertop.service\n# systemctl start powertop.service\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eLaptop Mode Tools\u003c/h3\u003e\n\u003cp\u003eLaptop Mode Tools\u003csup\u003e\u003ca href=\"#user-content-fn-6\" id=\"user-content-fnref-6\" data-footnote-ref aria-describedby=\"footnote-label\"\u003e9\u003c/a\u003e\u003c/sup\u003e is a\nlaptop power saving package for Linux systems. It is the primary way to enable\nthe Laptop Mode feature of the Linux kernel, which allows you to tweak a number\nof other power-related settings using a simple configuration file. Combined with\n\u003ccode\u003eacpid\u003c/code\u003e and CPU frequency scaling, LMT provides a complete notebook power\nmanagement suite.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e$ yaourt -S laptop-mode-tools\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf you want to enable laptop mode even on AC power, because you run the laptop\nattached to an external keyboard and monitor, edit:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# /etc/laptop-mode/laptop-mode.conf`:\n...\nENABLE_LAPTOP_MODE_ON_AC=1\n...\nENABLE_LAPTOP_MODE_WHEN_LID_CLOSED=1\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe're going to disable LMT from handling CPU frequency scaling since we've setup\n\u003ccode\u003ecpupower\u003c/code\u003e to handle that:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# /etc/laptop-mode/conf.d/cpufreq.conf\n...\n# CONTROL_CPU_FREQUENCY=\"AUTO\"\nCONTROL_CPU_FREQUENCY=0\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eand disable Intel pstate handling as well:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# /etc/laptop-mode/conf.d/intel_pstate.conf\n# CONTROL_INTEL_PSTATE=\"auto\"\nCONTROL_INTEL_PSTATE=0\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFinally, enable and start the systemd service:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# systemctl enable laptop-mode.service\n# systemctl start  laptop-mode.service\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eacpid\u003c/h3\u003e\n\u003cp\u003eA very useful tool is from the \u003ccode\u003eacpi\u003c/code\u003e package, which provides battery\ninformation using the command \u003ccode\u003eacpi -v\u003c/code\u003e. To install:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# pacman -S acpi\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eacpid\u003c/code\u003e is an extensible daemon for handling ACPI events. It can run commands\nwhen the laptop lid is closed, etc.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# pacman -S acpid\n# systemctl enable acpid.service\n# systemctl start  acpid.service\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eCPU Frequency Scaling\u003c/h3\u003e\n\u003cp\u003eAnother utility that will help with CPU frequency scaling is \u003ccode\u003ecpupower\u003c/code\u003e, it\nprovides useful CLI utilities and a systemd service to change the CPU governor\nat boot.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e$ yaourt -S cpupower\n# systemctl enable cpupower\n# systemctl start cpupower\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI use cpupower to modulate the CPU’s speeds. This keeps CPU in check from maxing\nout at all times. My cpupower config file at \u003ccode\u003e/etc/default/cpupower\u003c/code\u003e has the\nfollowing line changed:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egovernor='powersave'\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou should adjust this setting to your own needs.\u003c/p\u003e\n\u003ch3\u003eTemperature Management\u003c/h3\u003e\n\u003cp\u003eIntel provides a daemon that will keep tabs on the CPUs’ temperature and adjust\nsettings to keep it from getting too hot, its called \u003ccode\u003ethermald\u003c/code\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e$ yaourt -S thermald\n# systemctl enable thermald.service\n# systemctl start thermald.service\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eFan Control\u003c/h3\u003e\n\u003cp\u003eFinally, the kernel doesn’t seem to have very fine control over the MacBook’s\nfan. The following script helps add fine-tuning for the fan that will increase\nits baseline speed and ramp it up gently, so it’s not an all-or-nothing kind of\nsetup.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e$ yaourt -S mbpfan-git\n# systemctl enable mbpfan.service\n# systemctl start mbpfan.service\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBy default the service runs in verbose mode which adds tons of output to the\nsystem journal. It basically works by measuring the CPU temp, adjusting the fan\nspeed accordingly, and then sleeping for a given number of seconds. With verbose\nmode on, it logs its wakeup every few seconds. That means a lot of writing to\nthe journal. So I changed the service under\n\u003ccode\u003e/usr/lib/systemd/system/mbpfan.service\u003c/code\u003e so the following line reads like so:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eExecStart=/usr/sbin/mbpfan -f\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eApple Keyboard\u003c/h3\u003e\n\u003cp\u003eTo get the \u003ccode\u003efn\u003c/code\u003e keys working in X, we will install \u003ccode\u003exbindkeys\u003c/code\u003e which helps bind\nkeyboard keys to commands. We will bind keys for volume, keyboard and display\nbrightness.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e```bash\n# pacman -S xbindkeys\nyaourt -S xorg-xbacklight kbdlight\n```\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCreate your configuration file for xbindkeys: \u003ccode\u003e.xbindkeysrc\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# Increase volume 5% with Apple volume up\n\"amixer set Master playback 5%+\"\n    m:0x0 + c:123\n    XF86AudioRaiseVolume\n# Increase volume 5% with F12\n\"amixer set Master playback 5%+\"\n    m:0x0 + c:96\n\n\n# Decrease volume 5% with Apple volume down\n\"amixer set Master playback 5%-\"\n    m:0x0 + c:122\n    XF86AudioLowerVolume\n# Decrease volume 5% with F11\n\"amixer set Master playback 5%-\"\n    m:0x0 + c:95\n\n\n# Mute with Apple mute\n\"amixer set Master toggle\"\n    m:0x0 + c:121\n    XF86AudioMute\n# Mute with F10\n\"amixer set Master toggle\"\n    m:0x0 + c:76\n\n\n# Suspend system\n\"systemctl suspend\"\n    m:0x0 + Mod4 + c:107\n    Mod4 + XF86Eject\n\n\n# Dim keyboard\n\"kbdlight down\"\n    m:0x0 + c:237\n    XF86KbdBrightnessUp\n\n\n# Brighten keyboard\n\"kbdlight up\"\n    m:0x0 + c:238\n    XF86KbdBrightnessDown\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNext we'll auto-start xbindkeys when X starts, add this to your \u003ccode\u003e.xinitrc\u003c/code\u003e file:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eif [ `type -P xbindkeys` ]; then\n  # Load custom keyboard key bindings\n  xbindkeys\nfi;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eApple Trackpad\u003c/h3\u003e\n\u003cp\u003eFinally\u003csup\u003e\u003ca href=\"#user-content-fn-3\" id=\"user-content-fnref-3\" data-footnote-ref aria-describedby=\"footnote-label\"\u003e10\u003c/a\u003e\u003c/sup\u003e, we'll setup a\nBluetooth Apple Trackpad. To do this, we'll install some bluetooth core\nutilities\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# pacman -S bluez bluez-utils\n# modprobe btusb  # Make sure bluetooth kernel module is loaded\n# systemctl enable bluetooth.service  # Start bluetooth on reboot\n# systemctl start bluetooth.service\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo actually connect to the Trackpad, we'll use the \u003ccode\u003ebluetoothctl\u003c/code\u003e interactive\nutility to scan-for, discover, pair and connect to the Trackpad. (If your\nTrackpad is already paired with another device, make sure to turn it off, then\nlong-hold the power button until the LED flashes.)\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ bluetoothctl\n\u003e power on\n\u003e scan on\n\u003e agent on\n\u003e devices    # You should see the MAC address of your Trackpad appear if its in discoverable mode\n\u003e pair mac 28:37:37:2B:42:7A\n\u003e connect 28:37:37:2B:42:7A\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen we'll setup some \u003ccode\u003eudev\u003c/code\u003e rules so USB Bluetooth is activated and loade when\nthe system boots up.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# /etc/udev/rules.d/10-local.rules\n# Set bluetooth power up\nACTION==\"add\", KERNEL==\"hci0\", RUN+=\"/usr/bin/hciconfig hci0 up\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eWrapping up, I have nothing to add other than what you do with your system is up\nto you.\u003c/p\u003e\n\u003ch2\u003eReferences\u003c/h2\u003e\n\u003cp\u003eThe following articles were very useful in providing some help and inspiration.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://mchladek.me/post/arch-mbp/\"\u003eInstalling Arch Linux on a MacBook Pro - Michael Chladek\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://zanshin.net/2015/02/05/arch-linux-on-a-macbook-pro-part-1-creating-a-usb-installer/\"\u003eIntroductory MacBook Arch Guide - Zanshin\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://loicpefferkorn.net/2015/01/arch-linux-on-macbook-pro-retina-2014-with-dm-crypt-lvm-and-suspend-to-disk/\"\u003eArch Linux on MacBook Pro Retina 2014 with DM-Crypt, LVM and suspend to disk - Loïc Pefferkorn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://wiki.archlinux.org/index.php/MacBook\"\u003eArchWiki MacBook\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://wiki.archlinux.org/index.php/MacBookPro11,x\"\u003eArchWiki MacBookPro11,x\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://medium.com/@philpl/arch-linux-running-on-my-macbook-2ea525ebefe3#.ai90cnihe\"\u003eArch Linux Running on my MacBook - Phil Plückthun\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.youtube.com/watch?v=Fzmm87oVQ6c\"\u003eMy personal fight against the modern laptop\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAny changes to this article will be annotated with a footnote and explained\nhere.\u003c/p\u003e\n\u003csection data-footnotes class=\"footnotes\"\u003e\u003ch2 class=\"sr-only\" id=\"footnote-label\"\u003eFootnotes\u003c/h2\u003e\n\u003col\u003e\n\u003cli id=\"user-content-fn-1\"\u003e\n\u003cp\u003eMarch 6, 2016: Previously used \u003ccode\u003eNetworkManager\u003c/code\u003e to detect\nand connect to WiFi networks, but have changed to use\n\u003ccode\u003enetctl\u003c/code\u003e and \u003ccode\u003ewifi-menu\u003c/code\u003e as these commands are\nmore low-level and have fewer dependencies. \u003ca href=\"#user-content-fnref-1\" data-footnote-backref class=\"data-footnote-backref\" aria-label=\"Back to content\"\u003e↩\u003c/a\u003e \u003ca href=\"#user-content-fnref-1-2\" data-footnote-backref class=\"data-footnote-backref\" aria-label=\"Back to content\"\u003e↩\u003csup\u003e2\u003c/sup\u003e\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"user-content-fn-4\"\u003e\n\u003cp\u003eMarch 14, 2016: Thanks\n\u003ca href=\"https://www.reddit.com/r/archlinux/comments/493k4n/installing_encrypted_arch_linux_on_an_apple/d0y36h4?context=3\"\u003eFr0gm4n\u003c/a\u003e\nfor suggestions simplifying the writing of \u003ccode\u003eiso\u003c/code\u003e\nimages to USB. \u003ca href=\"#user-content-fnref-4\" data-footnote-backref class=\"data-footnote-backref\" aria-label=\"Back to content\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"user-content-fn-7\"\u003e\n\u003cp\u003eApril 2, 2016: Thanks\n\u003ca href=\"https://www.reddit.com/r/archlinux/comments/493k4n/installing_encrypted_arch_linux_on_an_apple/d1mleow?context=3\"\u003ePerceptes\u003c/a\u003e\nfor helping to clarify the text explaining how to configure the bootloader. \u003ca href=\"#user-content-fnref-7\" data-footnote-backref class=\"data-footnote-backref\" aria-label=\"Back to content\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"user-content-fn-9\"\u003e\n\u003cp\u003eDecember 2, 2016: Thanks to Joshua Brown for clarifications to writing the bootloader line. \u003ca href=\"#user-content-fnref-9\" data-footnote-backref class=\"data-footnote-backref\" aria-label=\"Back to content\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"user-content-fn-8\"\u003e\n\u003cp\u003eJuly 28, 2016: Updated to support Macbookpro 11,3 devices with NVidia cards. This device uses NVIDIA GeForce GT 750M (Codename NVE7/GK107). \u003ca href=\"#user-content-fnref-8\" data-footnote-backref class=\"data-footnote-backref\" aria-label=\"Back to content\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"user-content-fn-10\"\u003e\n\u003cp\u003eFebruary 6, 2017: If anyone has a solution to the loss of Infinality bundle\ntypography, please drop me a line. \u003ca href=\"#user-content-fnref-10\" data-footnote-backref class=\"data-footnote-backref\" aria-label=\"Back to content\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"user-content-fn-5\"\u003e\n\u003cp\u003eMarch 18, 2016: Changed references to \u003ccode\u003e.Xinitrc\u003c/code\u003e to the\ncorrect filename, \u003ccode\u003e.xinitrc\u003c/code\u003e. \u003ca href=\"#user-content-fnref-5\" data-footnote-backref class=\"data-footnote-backref\" aria-label=\"Back to content\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"user-content-fn-2\"\u003e\n\u003cp\u003eMarch 8, 2016: Previously omitted the \u003ccode\u003e-S\u003c/code\u003e option in\nyaourt, fixed. \u003ca href=\"#user-content-fnref-2\" data-footnote-backref class=\"data-footnote-backref\" aria-label=\"Back to content\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"user-content-fn-6\"\u003e\n\u003cp\u003eMarch 24, 2016: Added two new sections documenting Laptop Mode Tools\nand \u003ccode\u003eacpid\u003c/code\u003e. \u003ca href=\"#user-content-fnref-6\" data-footnote-backref class=\"data-footnote-backref\" aria-label=\"Back to content\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"user-content-fn-3\"\u003e\n\u003cp\u003eMarch 8, 2016: Added a section covering the Apple Trackpad. \u003ca href=\"#user-content-fnref-3\" data-footnote-backref class=\"data-footnote-backref\" aria-label=\"Back to content\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/section\u003e\n","slug":"2016-03-05-install-encrypted-arch-linux-on-apple-macbook-pro","license":"cc-by-nc-sa"}},"__N_SSG":true},"page":"/[year]/[month]/[day]/[slug]","query":{"year":"2016","month":"03","day":"05","slug":"install-encrypted-arch-linux-on-apple-macbook-pro"},"buildId":"x1pzJ5b6uIlSp_6eMoFIg","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>